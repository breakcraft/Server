var D=document.getElementById("canvas"),w=D.getContext("2d",{willReadFrequently:!0}),J0=document.createElement("canvas"),Q0=document.createElement("img"),M0=J0.getContext("2d",{willReadFrequently:!0});class T0{key=0n;next=null;prev=null;unlink(){if(this.prev!=null){if(this.prev.next=this.next,this.next)this.next.prev=this.prev;this.next=null,this.prev=null}}}class N0 extends T0{next2=null;prev2=null;unlink2(){if(this.prev2!==null){if(this.prev2.next2=this.next2,this.next2)this.next2.prev2=this.prev2;this.next2=null,this.prev2=null}}}class F extends N0{static pixels=new Int32Array;static width2d=0;static height2d=0;static top=0;static bottom=0;static left=0;static right=0;static boundX=0;static centerX2d=0;static centerY2d=0;static bind(L,N,$){this.pixels=L,this.width2d=N,this.height2d=$,this.setBounds(0,0,N,$)}static resetBounds(){this.left=0,this.top=0,this.right=this.width2d,this.bottom=this.height2d,this.boundX=this.right-1,this.centerX2d=this.right/2|0}static setBounds(L,N,$,G){if(L<0)L=0;if(N<0)N=0;if($>this.width2d)$=this.width2d;if(G>this.height2d)G=this.height2d;this.top=N,this.bottom=G,this.left=L,this.right=$,this.boundX=this.right-1,this.centerX2d=this.right/2|0,this.centerY2d=this.bottom/2|0}static clear(){let L=this.width2d*this.height2d;for(let N=0;N<L;N++)this.pixels[N]=0}static drawRect(L,N,$,G,m){this.drawHorizontalLine(L,N,m,$),this.drawHorizontalLine(L,N+G-1,m,$),this.drawVerticalLine(L,N,m,G),this.drawVerticalLine(L+$-1,N,m,G)}static drawRectAlpha(L,N,$,G,m,Q){if(this.drawHorizontalLineAlpha(L,N,m,$,Q),this.drawHorizontalLineAlpha(L,N+G-1,m,$,Q),G>=3)this.drawVerticalLineAlpha(L,N,m,G,Q),this.drawVerticalLineAlpha(L+$-1,N,m,G,Q)}static drawHorizontalLine(L,N,$,G){if(N<this.top||N>=this.bottom)return;if(L<this.left)G-=this.left-L,L=this.left;if(L+G>this.right)G=this.right-L;let m=L+N*this.width2d;for(let Q=0;Q<G;Q++)this.pixels[m+Q]=$}static drawHorizontalLineAlpha=(L,N,$,G,m)=>{if(N<this.top||N>=this.bottom)return;if(L<this.left)G-=this.left-L,L=this.left;if(L+G>this.right)G=this.right-L;let Q=256-m,J=($>>16&255)*m,T=($>>8&255)*m,E=($&255)*m,H=this.width2d-G,Z=L+N*this.width2d;for(let q=0;q<G;q++){let W=(this.pixels[Z]>>16&255)*Q,M=(this.pixels[Z]>>8&255)*Q,I=(this.pixels[Z]&255)*Q,U=(J+W>>8<<16)+(T+M>>8<<8)+(E+I>>8);this.pixels[Z++]=U}};static drawVerticalLine(L,N,$,G){if(L<this.left||L>=this.right)return;if(N<this.top)G-=this.top-N,N=this.top;if(N+G>this.bottom)G=this.bottom-N;let m=L+N*this.width2d;for(let Q=0;Q<G;Q++)this.pixels[m+Q*this.width2d]=$}static drawVerticalLineAlpha=(L,N,$,G,m)=>{if(L<this.left||L>=this.right)return;if(N<this.top)G-=this.top-N,N=this.top;if(N+G>this.bottom)G=this.bottom-N;let Q=256-m,J=($>>16&255)*m,T=($>>8&255)*m,E=($&255)*m,H=L+N*this.width2d;for(let Z=0;Z<G;Z++){let q=(this.pixels[H]>>16&255)*Q,W=(this.pixels[H]>>8&255)*Q,M=(this.pixels[H]&255)*Q,I=(J+q>>8<<16)+(T+W>>8<<8)+(E+M>>8);this.pixels[H]=I,H+=this.width2d}};static drawLine(L,N,$,G,m){let Q=Math.abs($-L),J=Math.abs(G-N),T=L<$?1:-1,E=N<G?1:-1,H=Q-J;while(!0){if(L>=this.left&&L<this.right&&N>=this.top&&N<this.bottom)this.pixels[L+N*this.width2d]=m;if(L===$&&N===G)break;let Z=2*H;if(Z>-J)H=H-J,L=L+T;if(Z<Q)H=H+Q,N=N+E}}static fillRect2d(L,N,$,G,m){if(L<this.left)$-=this.left-L,L=this.left;if(N<this.top)G-=this.top-N,N=this.top;if(L+$>this.right)$=this.right-L;if(N+G>this.bottom)G=this.bottom-N;let Q=this.width2d-$,J=L+N*this.width2d;for(let T=-G;T<0;T++){for(let E=-$;E<0;E++)this.pixels[J++]=m;J+=Q}}static fillRectAlpha(L,N,$,G,m,Q){if(L<this.left)$-=this.left-L,L=this.left;if(N<this.top)G-=this.top-N,N=this.top;if(L+$>this.right)$=this.right-L;if(N+G>this.bottom)G=this.bottom-N;let J=256-Q,T=(m>>16&255)*Q,E=(m>>8&255)*Q,H=(m&255)*Q,Z=this.width2d-$,q=L+N*this.width2d;for(let W=0;W<G;W++){for(let M=-$;M<0;M++){let I=(this.pixels[q]>>16&255)*J,U=(this.pixels[q]>>8&255)*J,j=(this.pixels[q]&255)*J,_=(T+I>>8<<16)+(E+U>>8<<8)+(H+j>>8);this.pixels[q++]=_}q+=Z}}static fillCircle(L,N,$,G,m){let Q=256-m,J=(G>>16&255)*m,T=(G>>8&255)*m,E=(G&255)*m,H=N-$;if(H<0)H=0;let Z=N+$;if(Z>=this.height2d)Z=this.height2d-1;for(let q=H;q<=Z;q++){let W=q-N,M=Math.sqrt($*$-W*W)|0,I=L-M;if(I<0)I=0;let U=L+M;if(U>=this.width2d)U=this.width2d-1;let j=I+q*this.width2d;for(let _=I;_<=U;_++){let X=(this.pixels[j]>>16&255)*Q,k=(this.pixels[j]>>8&255)*Q,u=(this.pixels[j]&255)*Q,b=(J+X>>8<<16)+(T+k>>8<<8)+(E+u>>8);this.pixels[j++]=b}}}static setPixel(L,N,$){if(L<this.left||L>=this.right||N<this.top||N>=this.bottom)return;this.pixels[L+N*this.width2d]=$}}class H0{sentinel=new T0;cursor=null;constructor(){this.sentinel.next=this.sentinel,this.sentinel.prev=this.sentinel}push(L){if(L.prev)L.unlink();if(L.prev=this.sentinel.prev,L.next=this.sentinel,L.prev)L.prev.next=L;L.next.prev=L}addHead(L){if(L.prev)L.unlink();if(L.prev=this.sentinel,L.next=this.sentinel.next,L.prev.next=L,L.next)L.next.prev=L}pop(){let L=this.sentinel.next;if(L===this.sentinel)return null;return L?.unlink(),L}head(){let L=this.sentinel.next;if(L===this.sentinel)return this.cursor=null,null;return this.cursor=L?.next||null,L}tail(){let L=this.sentinel.prev;if(L===this.sentinel)return this.cursor=null,null;return this.cursor=L?.prev||null,L}next(){let L=this.cursor;if(L===this.sentinel)return this.cursor=null,null;return this.cursor=L?.next||null,L}prev(){let L=this.cursor;if(L===this.sentinel)return this.cursor=null,null;return this.cursor=L?.prev||null,L}clear(){while(!0){let L=this.sentinel.next;if(L===this.sentinel)return;L?.unlink()}}}var E0=async(L)=>new Promise((N)=>setTimeout(N,L)),k0=async(L)=>new Uint8Array(await(await fetch(L)).arrayBuffer());function b0(L){let N=0n;for(let $=0;$<L.length;$++)N=N<<8n|BigInt(L[$]);return N}function X0(L){let N=[];while(L>0n)N.unshift(Number(L&0xffn)),L>>=8n;if(N[0]&128)N.unshift(0);return new Uint8Array(N)}function Y0(L,N,$){let G=1n;while(N>0n){if(N%2n===1n)G=G*L%$;L=L*L%$,N>>=1n}return G}class v extends N0{static CRC32_POLYNOMIAL=3988292384;static crctable=new Int32Array(256);static bitmask=new Uint32Array(33);static cacheMin=new H0;static cacheMid=new H0;static cacheMax=new H0;static cacheMinCount=0;static cacheMidCount=0;static cacheMaxCount=0;static{for(let L=0;L<32;L++)v.bitmask[L]=(1<<L)-1;v.bitmask[32]=4294967295;for(let L=0;L<256;L++){let N=L;for(let $=0;$<8;$++)if((N&1)===1)N=N>>>1^v.CRC32_POLYNOMIAL;else N>>>=1;v.crctable[L]=N}}static getcrc(L,N,$){let G=4294967295;for(let m=N;m<$;m++)G=G>>>8^this.crctable[(G^L[m])&255];return~G}static checkcrc(L,N,$,G=0){return v.getcrc(L,N,$)==G}view;data;pos=0;bitPos=0;random=null;constructor(L){if(!L)throw new Error;super();if(L instanceof Int8Array)this.data=new Uint8Array(L);else this.data=L;this.view=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}get length(){return this.view.byteLength}get available(){return this.view.byteLength-this.pos}static alloc(L){let N=null;if(L===0&&v.cacheMinCount>0)v.cacheMinCount--,N=v.cacheMin.pop();else if(L===1&&v.cacheMidCount>0)v.cacheMidCount--,N=v.cacheMid.pop();else if(L===2&&v.cacheMaxCount>0)v.cacheMaxCount--,N=v.cacheMax.pop();if(N)return N.pos=0,N;if(L===0)return new v(new Uint8Array(100));else if(L===1)return new v(new Uint8Array(5000));else return new v(new Uint8Array(30000))}release(){if(this.pos=0,this.length===100&&v.cacheMinCount<1000)v.cacheMin.push(this),v.cacheMinCount++;else if(this.length===5000&&v.cacheMidCount<250)v.cacheMid.push(this),v.cacheMidCount++;else if(this.length===30000&&v.cacheMaxCount<50)v.cacheMax.push(this),v.cacheMaxCount++}g1(){return this.view.getUint8(this.pos++)}g1b(){return this.view.getInt8(this.pos++)}g2(){let L=this.view.getUint16(this.pos);return this.pos+=2,L}g2b(){let L=this.view.getInt16(this.pos);return this.pos+=2,L}g3(){let L=this.view.getUint8(this.pos++)<<16|this.view.getUint16(this.pos);return this.pos+=2,L}g4(){let L=this.view.getInt32(this.pos);return this.pos+=4,L}g8(){let L=this.view.getBigInt64(this.pos);return this.pos+=8,L}gsmart(){return this.view.getUint8(this.pos)<128?this.g1()-64:this.g2()-49152}gsmarts(){return this.view.getUint8(this.pos)<128?this.g1():this.g2()-32768}gjstr(){let L=this.view,N=L.byteLength,$="",G;while((G=L.getUint8(this.pos++))!==10&&this.pos<N)$+=String.fromCharCode(G);return $}gdata(L,N,$){$.set(this.data.subarray(this.pos,this.pos+L),N),this.pos+=L}p1isaac(L){this.view.setUint8(this.pos++,L+(this.random?.nextInt??0)&255)}p1(L){this.view.setUint8(this.pos++,L)}p2(L){this.view.setUint16(this.pos,L),this.pos+=2}ip2(L){this.view.setUint16(this.pos,L,!0),this.pos+=2}p3(L){this.view.setUint8(this.pos++,L>>16),this.view.setUint16(this.pos,L),this.pos+=2}p4(L){this.view.setInt32(this.pos,L),this.pos+=4}ip4(L){this.view.setInt32(this.pos,L,!0),this.pos+=4}p8(L){this.view.setBigInt64(this.pos,L),this.pos+=8}pjstr(L){let N=this.view,$=L.length;for(let G=0;G<$;G++)N.setUint8(this.pos++,L.charCodeAt(G));N.setUint8(this.pos++,10)}pdata(L,N,$){this.data.set(L.subarray($,$+N),this.pos),this.pos+=N-$}psize1(L){this.view.setUint8(this.pos-L-1,L)}bits(){this.bitPos=this.pos<<3}bytes(){this.pos=this.bitPos+7>>>3}gBit(L){let N=this.bitPos>>>3,$=8-(this.bitPos&7),G=0;this.bitPos+=L;for(;L>$;$=8)G+=(this.view.getUint8(N++)&v.bitmask[$])<<L-$,L-=$;if(L===$)G+=this.view.getUint8(N)&v.bitmask[$];else G+=this.view.getUint8(N)>>>$-L&v.bitmask[L];return G}rsaenc(L,N){let $=this.pos;this.pos=0;let G=new Uint8Array($);this.gdata($,0,G);let m=b0(G),Q=Y0(m,N,L),J=X0(Q);this.pos=0,this.p1(J.length),this.pdata(J,J.length,0)}}class $0 extends N0{pixels;width2d;height2d;cropX;cropY;cropW;cropH;rgbPal;constructor(L,N,$){super();this.pixels=new Int8Array(L*N),this.width2d=this.cropW=L,this.height2d=this.cropH=N,this.cropX=this.cropY=0,this.rgbPal=$}static fromArchive(L,N,$=0){let G=new v(L.read(N+".dat")),m=new v(L.read("index.dat"));m.pos=G.g2();let Q=m.g2(),J=m.g2(),T=m.g1(),E=new Int32Array(T);for(let j=1;j<T;j++)if(E[j]=m.g3(),E[j]===0)E[j]=1;for(let j=0;j<$;j++)m.pos+=2,G.pos+=m.g2()*m.g2(),m.pos+=1;if(G.pos>G.length||m.pos>m.length)throw new Error;let H=m.g1(),Z=m.g1(),q=m.g2(),W=m.g2(),M=new $0(q,W,E);M.cropX=H,M.cropY=Z,M.cropW=Q,M.cropH=J;let I=M.pixels,U=m.g1();if(U===0){let j=M.width2d*M.height2d;for(let _=0;_<j;_++)I[_]=G.g1b()}else if(U===1){let{width2d:j,height2d:_}=M;for(let X=0;X<j;X++)for(let k=0;k<_;k++)I[X+k*j]=G.g1b()}return M}draw(L,N){L|=0,N|=0,L+=this.cropX,N+=this.cropY;let $=L+N*F.width2d,G=0,m=this.height2d,Q=this.width2d,J=F.width2d-Q,T=0;if(N<F.top){let E=F.top-N;m-=E,N=F.top,G+=E*Q,$+=E*F.width2d}if(N+m>F.bottom)m-=N+m-F.bottom;if(L<F.left){let E=F.left-L;Q-=E,L=F.left,G+=E,$+=E,T+=E,J+=E}if(L+Q>F.right){let E=L+Q-F.right;Q-=E,T+=E,J+=E}if(Q>0&&m>0)this.copyImage(Q,m,this.pixels,G,T,F.pixels,$,J)}flipHorizontally(){let L=this.pixels,N=this.width2d,$=this.height2d;for(let G=0;G<$;G++){let m=N/2|0;for(let Q=0;Q<m;Q++){let J=Q+G*N,T=N-Q-1+G*N,E=L[J];L[J]=L[T],L[T]=E}}}flipVertically(){let L=this.pixels,N=this.width2d,$=this.height2d;for(let G=0;G<($/2|0);G++)for(let m=0;m<N;m++){let Q=m+G*N,J=m+($-G-1)*N,T=L[Q];L[Q]=L[J],L[J]=T}}translate2d(L,N,$){for(let G=0;G<this.rgbPal.length;G++){let m=this.rgbPal[G]>>16&255;if(m+=L,m<0)m=0;else if(m>255)m=255;let Q=this.rgbPal[G]>>8&255;if(Q+=N,Q<0)Q=0;else if(Q>255)Q=255;let J=this.rgbPal[G]&255;if(J+=$,J<0)J=0;else if(J>255)J=255;this.rgbPal[G]=(m<<16)+(Q<<8)+J}}shrink(){this.cropW|=0,this.cropH|=0,this.cropW/=2,this.cropH/=2,this.cropW|=0,this.cropH|=0;let L=new Int8Array(this.cropW*this.cropH),N=0;for(let $=0;$<this.height2d;$++)for(let G=0;G<this.width2d;G++)L[(G+this.cropX>>1)+($+this.cropY>>1)*this.cropW]=this.pixels[N++];this.pixels=L,this.width2d=this.cropW,this.height2d=this.cropH,this.cropX=0,this.cropY=0}crop(){if(this.width2d===this.cropW&&this.height2d===this.cropH)return;let L=new Int8Array(this.cropW*this.cropH),N=0;for(let $=0;$<this.height2d;$++)for(let G=0;G<this.width2d;G++)L[G+this.cropX+($+this.cropY)*this.cropW]=this.pixels[N++];this.pixels=L,this.width2d=this.cropW,this.height2d=this.cropH,this.cropX=0,this.cropY=0}copyImage(L,N,$,G,m,Q,J,T){let E=-(L>>2);L=-(L&3);for(let H=-N;H<0;H++){for(let Z=E;Z<0;Z++){let q=$[G++];if(q===0)J++;else Q[J++]=this.rgbPal[q&255];if(q=$[G++],q===0)J++;else Q[J++]=this.rgbPal[q&255];if(q=$[G++],q===0)J++;else Q[J++]=this.rgbPal[q&255];if(q=$[G++],q===0)J++;else Q[J++]=this.rgbPal[q&255]}for(let Z=L;Z<0;Z++){let q=$[G++];if(q===0)J++;else Q[J++]=this.rgbPal[q&255]}J+=T,G+=m}}clip(L,N,$,G){try{let m=this.width2d,Q=this.height2d,J=0,T=0,E=(m<<16)/$|0,H=(Q<<16)/G|0,Z=this.cropW,q=this.cropH,W=(Z<<16)/$|0,M=(q<<16)/G|0;if(L=L+(this.cropX*$+Z-1)/Z|0,N=N+(this.cropY*G+q-1)/q|0,this.cropX*$%Z!=0)J=(Z-this.cropX*$%Z<<16)/$|0;if(this.cropY*G%q!=0)T=(q-this.cropY*G%q<<16)/G|0;$=$*(this.width2d-(J>>16))/Z|0,G=G*(this.height2d-(T>>16))/q|0;let I=L+N*F.width2d,U=F.width2d-$,j;if(N<F.top)j=F.top-N,G-=j,N=0,I+=j*F.width2d,T+=M*j;if(N+G>F.bottom)G-=N+G-F.bottom;if(L<F.left)j=F.left-L,$-=j,L=0,I+=j,J+=W*j,U+=j;if(L+$>F.right)j=L+$-F.right,$-=j,U+=j;this.plot_scale(F.pixels,this.pixels,this.rgbPal,J,T,I,U,$,G,W,M,m)}catch(m){}}plot_scale(L,N,$,G,m,Q,J,T,E,H,Z,q){try{let W=G;for(let M=-E;M<0;M++){let I=(m>>16)*q;for(let U=-T;U<0;U++){let j=N[(G>>16)+I];if(j==0)Q++;else L[Q++]=$[j&255];G+=H}m+=Z,G=W,Q+=J}}catch(W){}}}class G0 extends Array{constructor(L,N){super(L);for(let $=0;$<L;$++)this[$]=N}}class t extends Array{constructor(L,N,$){super(L);for(let G=0;G<L;G++){this[G]=new Array(N);for(let m=0;m<N;m++)this[G][m]=$}}}class R0 extends Array{constructor(L,N){super(L);for(let $=0;$<L;$++)this[$]=new Int32Array(N)}}class h extends F{static lowMemory=!1;static reciprocal15=new Int32Array(512);static reciprocal16=new Int32Array(2048);static sin=new Int32Array(2048);static cos=new Int32Array(2048);static hslPal=new Int32Array(65536);static textures=new G0(50,null);static textureCount=0;static lineOffset=new Int32Array;static centerX=0;static centerY=0;static jagged=!0;static clipX=!1;static alpha=0;static texelPool=null;static activeTexels=new G0(50,null);static poolSize=0;static cycle=0;static textureCycle=new Int32Array(50);static texPal=new G0(50,null);static opaque=!1;static textureTranslucent=new G0(50,!1);static averageTextureRGB=new Int32Array(50);static{for(let L=1;L<512;L++)this.reciprocal15[L]=32768/L|0;for(let L=1;L<2048;L++)this.reciprocal16[L]=65536/L|0;for(let L=0;L<2048;L++)this.sin[L]=Math.sin(L*0.0030679615757712823)*65536|0,this.cos[L]=Math.cos(L*0.0030679615757712823)*65536|0}static init2D(){this.lineOffset=new Int32Array(F.height2d);for(let L=0;L<F.height2d;L++)this.lineOffset[L]=F.width2d*L;this.centerX=F.width2d/2|0,this.centerY=F.height2d/2|0}static init3D(L,N){this.lineOffset=new Int32Array(N);for(let $=0;$<N;$++)this.lineOffset[$]=L*$;this.centerX=L/2|0,this.centerY=N/2|0}static clearTexels(){this.texelPool=null,this.activeTexels.fill(null)}static unpackTextures(L){this.textureCount=0;for(let N=0;N<50;N++)try{if(this.textures[N]=$0.fromArchive(L,N.toString()),this.lowMemory&&this.textures[N]?.cropW===128)this.textures[N]?.shrink();else this.textures[N]?.crop();this.textureCount++}catch($){}}static getAverageTextureRGB(L){if(this.averageTextureRGB[L]!==0)return this.averageTextureRGB[L];let N=this.texPal[L];if(!N)return 0;let $=0,G=0,m=0,Q=N.length;for(let T=0;T<Q;T++)$+=N[T]>>16&255,G+=N[T]>>8&255,m+=N[T]&255;let J=(($/Q|0)<<16)+((G/Q|0)<<8)+(m/Q|0);if(J=this.setGamma(J,1.4),J===0)J=1;return this.averageTextureRGB[L]=J,J}static setBrightness(L){let N=L+Math.random()*0.03-0.015,$=0;for(let G=0;G<512;G++){let m=(G/8|0)/64+0.0078125,Q=(G&7)/8+0.0625;for(let J=0;J<128;J++){let T=J/128,E=T,H=T,Z=T;if(Q!==0){let U;if(T<0.5)U=T*(Q+1);else U=T+Q-T*Q;let j=T*2-U,_=m+0.3333333333333333;if(_>1)_--;let X=m-0.3333333333333333;if(X<0)X++;if(_*6<1)E=j+(U-j)*6*_;else if(_*2<1)E=U;else if(_*3<2)E=j+(U-j)*(0.6666666666666666-_)*6;else E=j;if(m*6<1)H=j+(U-j)*6*m;else if(m*2<1)H=U;else if(m*3<2)H=j+(U-j)*(0.6666666666666666-m)*6;else H=j;if(X*6<1)Z=j+(U-j)*6*X;else if(X*2<1)Z=U;else if(X*3<2)Z=j+(U-j)*(0.6666666666666666-X)*6;else Z=j}let q=E*256|0,W=H*256|0,M=Z*256|0,I=(q<<16)+(W<<8)+M;this.hslPal[$++]=this.setGamma(I,N)}}for(let G=0;G<50;G++){let m=this.textures[G];if(!m)continue;let Q=m.rgbPal;this.texPal[G]=new Int32Array(Q.length);for(let J=0;J<Q.length;J++){let T=this.texPal[G];if(!T)continue;T[J]=this.setGamma(Q[J],N)}}for(let G=0;G<50;G++)this.pushTexture(G)}static setGamma(L,N){let $=(L>>16)/256,G=(L>>8&255)/256,m=(L&255)/256,Q=Math.pow($,N),J=Math.pow(G,N),T=Math.pow(m,N),E=Q*256|0,H=J*256|0,Z=T*256|0;return(E<<16)+(H<<8)+Z}static initPool(L){if(this.texelPool)return;if(this.poolSize=L,this.lowMemory)this.texelPool=new R0(L,16384);else this.texelPool=new R0(L,65536);this.activeTexels.fill(null)}static fillGouraudTriangle(L,N,$,G,m,Q,J,T,E){let H=0,Z=0;if(m!==G)H=(N-L<<16)/(m-G)|0,Z=(T-J<<15)/(m-G)|0;let q=0,W=0;if(Q!==m)q=($-N<<16)/(Q-m)|0,W=(E-T<<15)/(Q-m)|0;let M=0,I=0;if(Q!==G)M=(L-$<<16)/(G-Q)|0,I=(J-E<<15)/(G-Q)|0;if(G<=m&&G<=Q){if(G<F.bottom){if(m>F.bottom)m=F.bottom;if(Q>F.bottom)Q=F.bottom;if(m<Q){if($=L<<=16,E=J<<=15,G<0)$-=M*G,L-=H*G,E-=I*G,J-=Z*G,G=0;if(N<<=16,T<<=15,m<0)N-=q*m,T-=W*m,m=0;if(G!==m&&M<H||G===m&&M>q){Q-=m,m-=G,G=h.lineOffset[G];while(!0){if(m--,m<0)while(!0){if(Q--,Q<0)return;this.drawGouraudScanline($>>16,N>>16,E>>7,T>>7,F.pixels,G,0),$+=M,N+=q,E+=I,T+=W,G+=F.width2d}this.drawGouraudScanline($>>16,L>>16,E>>7,J>>7,F.pixels,G,0),$+=M,L+=H,E+=I,J+=Z,G+=F.width2d}}else{Q-=m,m-=G,G=h.lineOffset[G];while(!0){if(m--,m<0)while(!0){if(Q--,Q<0)return;this.drawGouraudScanline(N>>16,$>>16,T>>7,E>>7,F.pixels,G,0),$+=M,N+=q,E+=I,T+=W,G+=F.width2d}this.drawGouraudScanline(L>>16,$>>16,J>>7,E>>7,F.pixels,G,0),$+=M,L+=H,E+=I,J+=Z,G+=F.width2d}}}else{if(N=L<<=16,T=J<<=15,G<0)N-=M*G,L-=H*G,T-=I*G,J-=Z*G,G=0;if($<<=16,E<<=15,Q<0)$-=q*Q,E-=W*Q,Q=0;if(G!==Q&&M<H||G===Q&&q>H){m-=Q,Q-=G,G=h.lineOffset[G];while(!0){if(Q--,Q<0)while(!0){if(m--,m<0)return;this.drawGouraudScanline($>>16,L>>16,E>>7,J>>7,F.pixels,G,0),$+=q,L+=H,E+=W,J+=Z,G+=F.width2d}this.drawGouraudScanline(N>>16,L>>16,T>>7,J>>7,F.pixels,G,0),N+=M,L+=H,T+=I,J+=Z,G+=F.width2d}}else{m-=Q,Q-=G,G=h.lineOffset[G];while(!0){if(Q--,Q<0)while(!0){if(m--,m<0)return;this.drawGouraudScanline(L>>16,$>>16,J>>7,E>>7,F.pixels,G,0),$+=q,L+=H,E+=W,J+=Z,G+=F.width2d}this.drawGouraudScanline(L>>16,N>>16,J>>7,T>>7,F.pixels,G,0),N+=M,L+=H,T+=I,J+=Z,G+=F.width2d}}}}}else if(m<=Q){if(m<F.bottom){if(Q>F.bottom)Q=F.bottom;if(G>F.bottom)G=F.bottom;if(Q<G){if(L=N<<=16,J=T<<=15,m<0)L-=H*m,N-=q*m,J-=Z*m,T-=W*m,m=0;if($<<=16,E<<=15,Q<0)$-=M*Q,E-=I*Q,Q=0;if(m!==Q&&H<q||m===Q&&H>M){G-=Q,Q-=m,m=h.lineOffset[m];while(!0){if(Q--,Q<0)while(!0){if(G--,G<0)return;this.drawGouraudScanline(L>>16,$>>16,J>>7,E>>7,F.pixels,m,0),L+=H,$+=M,J+=Z,E+=I,m+=F.width2d}this.drawGouraudScanline(L>>16,N>>16,J>>7,T>>7,F.pixels,m,0),L+=H,N+=q,J+=Z,T+=W,m+=F.width2d}}else{G-=Q,Q-=m,m=h.lineOffset[m];while(!0){if(Q--,Q<0)while(!0){if(G--,G<0)return;this.drawGouraudScanline($>>16,L>>16,E>>7,J>>7,F.pixels,m,0),L+=H,$+=M,J+=Z,E+=I,m+=F.width2d}this.drawGouraudScanline(N>>16,L>>16,T>>7,J>>7,F.pixels,m,0),L+=H,N+=q,J+=Z,T+=W,m+=F.width2d}}}else{if($=N<<=16,E=T<<=15,m<0)$-=H*m,N-=q*m,E-=Z*m,T-=W*m,m=0;if(L<<=16,J<<=15,G<0)L-=M*G,J-=I*G,G=0;if(Q-=G,G-=m,m=h.lineOffset[m],H<q)while(!0){if(G--,G<0)while(!0){if(Q--,Q<0)return;this.drawGouraudScanline(L>>16,N>>16,J>>7,T>>7,F.pixels,m,0),L+=M,N+=q,J+=I,T+=W,m+=F.width2d}this.drawGouraudScanline($>>16,N>>16,E>>7,T>>7,F.pixels,m,0),$+=H,N+=q,E+=Z,T+=W,m+=F.width2d}else while(!0){if(G--,G<0)while(!0){if(Q--,Q<0)return;this.drawGouraudScanline(N>>16,L>>16,T>>7,J>>7,F.pixels,m,0),L+=M,N+=q,J+=I,T+=W,m+=F.width2d}this.drawGouraudScanline(N>>16,$>>16,T>>7,E>>7,F.pixels,m,0),$+=H,N+=q,E+=Z,T+=W,m+=F.width2d}}}}else if(Q<F.bottom){if(G>F.bottom)G=F.bottom;if(m>F.bottom)m=F.bottom;if(G<m){if(N=$<<=16,T=E<<=15,Q<0)N-=q*Q,$-=M*Q,T-=W*Q,E-=I*Q,Q=0;if(L<<=16,J<<=15,G<0)L-=H*G,J-=Z*G,G=0;if(m-=G,G-=Q,Q=h.lineOffset[Q],q<M)while(!0){if(G--,G<0)while(!0){if(m--,m<0)return;this.drawGouraudScanline(N>>16,L>>16,T>>7,J>>7,F.pixels,Q,0),N+=q,L+=H,T+=W,J+=Z,Q+=F.width2d}this.drawGouraudScanline(N>>16,$>>16,T>>7,E>>7,F.pixels,Q,0),N+=q,$+=M,T+=W,E+=I,Q+=F.width2d}else while(!0){if(G--,G<0)while(!0){if(m--,m<0)return;this.drawGouraudScanline(L>>16,N>>16,J>>7,T>>7,F.pixels,Q,0),N+=q,L+=H,T+=W,J+=Z,Q+=F.width2d}this.drawGouraudScanline($>>16,N>>16,E>>7,T>>7,F.pixels,Q,0),N+=q,$+=M,T+=W,E+=I,Q+=F.width2d}}else{if(L=$<<=16,J=E<<=15,Q<0)L-=q*Q,$-=M*Q,J-=W*Q,E-=I*Q,Q=0;if(N<<=16,T<<=15,m<0)N-=H*m,T-=Z*m,m=0;if(G-=m,m-=Q,Q=h.lineOffset[Q],q<M)while(!0){if(m--,m<0)while(!0){if(G--,G<0)return;this.drawGouraudScanline(N>>16,$>>16,T>>7,E>>7,F.pixels,Q,0),N+=H,$+=M,T+=Z,E+=I,Q+=F.width2d}this.drawGouraudScanline(L>>16,$>>16,J>>7,E>>7,F.pixels,Q,0),L+=q,$+=M,J+=W,E+=I,Q+=F.width2d}else while(!0){if(m--,m<0)while(!0){if(G--,G<0)return;this.drawGouraudScanline($>>16,N>>16,E>>7,T>>7,F.pixels,Q,0),N+=H,$+=M,T+=Z,E+=I,Q+=F.width2d}this.drawGouraudScanline($>>16,L>>16,E>>7,J>>7,F.pixels,Q,0),L+=q,$+=M,J+=W,E+=I,Q+=F.width2d}}}}static drawGouraudScanline(L,N,$,G,m,Q,J){let T;if(h.jagged){let E;if(h.clipX){if(N-L>3)E=(G-$)/(N-L)|0;else E=0;if(N>F.boundX)N=F.boundX;if(L<0)$-=L*E,L=0;if(L>=N)return;Q+=L,J=N-L>>2,E<<=2}else if(L<N)if(Q+=L,J=N-L>>2,J>0)E=(G-$)*h.reciprocal15[J]>>15;else E=0;else return;if(h.alpha===0)while(!0){if(J--,J<0){if(J=N-L&3,J>0){T=h.hslPal[$>>8];do m[Q++]=T,J--;while(J>0);return}break}T=h.hslPal[$>>8],$+=E,m[Q++]=T,m[Q++]=T,m[Q++]=T,m[Q++]=T}else{let H=h.alpha,Z=256-h.alpha;while(!0){if(J--,J<0){if(J=N-L&3,J>0){T=h.hslPal[$>>8],T=((T&16711935)*Z>>8&16711935)+((T&65280)*Z>>8&65280);do m[Q++]=T+((m[Q]&16711935)*H>>8&16711935)+((m[Q]&65280)*H>>8&65280),J--;while(J>0)}break}T=h.hslPal[$>>8],$+=E,T=((T&16711935)*Z>>8&16711935)+((T&65280)*Z>>8&65280),m[Q++]=T+((m[Q]&16711935)*H>>8&16711935)+((m[Q]&65280)*H>>8&65280),m[Q++]=T+((m[Q]&16711935)*H>>8&16711935)+((m[Q]&65280)*H>>8&65280),m[Q++]=T+((m[Q]&16711935)*H>>8&16711935)+((m[Q]&65280)*H>>8&65280),m[Q++]=T+((m[Q]&16711935)*H>>8&16711935)+((m[Q]&65280)*H>>8&65280)}}}else if(L<N){let E=(G-$)/(N-L)|0;if(h.clipX){if(N>F.boundX)N=F.boundX;if(L<0)$-=L*E,L=0;if(L>=N)return}if(Q+=L,J=N-L,h.alpha===0)do m[Q++]=h.hslPal[$>>8],$+=E,J--;while(J>0);else{let H=h.alpha,Z=256-h.alpha;do T=h.hslPal[$>>8],$+=E,T=((T&16711935)*Z>>8&16711935)+((T&65280)*Z>>8&65280),m[Q++]=T+((m[Q]&16711935)*H>>8&16711935)+((m[Q]&65280)*H>>8&65280),J--;while(J>0)}}}static fillTriangle(L,N,$,G,m,Q,J){let T=0;if(m!==G)T=(N-L<<16)/(m-G)|0;let E=0;if(Q!==m)E=($-N<<16)/(Q-m)|0;let H=0;if(Q!==G)H=(L-$<<16)/(G-Q)|0;if(G<=m&&G<=Q){if(G<F.bottom){if(m>F.bottom)m=F.bottom;if(Q>F.bottom)Q=F.bottom;if(m<Q){if($=L<<=16,G<0)$-=H*G,L-=T*G,G=0;if(N<<=16,m<0)N-=E*m,m=0;if(G!==m&&H<T||G===m&&H>E){Q-=m,m-=G,G=this.lineOffset[G];while(!0){if(m--,m<0)while(!0){if(Q--,Q<0)return;this.drawScanline($>>16,N>>16,F.pixels,G,J),$+=H,N+=E,G+=F.width2d}this.drawScanline($>>16,L>>16,F.pixels,G,J),$+=H,L+=T,G+=F.width2d}}else{Q-=m,m-=G,G=this.lineOffset[G];while(!0){if(m--,m<0)while(!0){if(Q--,Q<0)return;this.drawScanline(N>>16,$>>16,F.pixels,G,J),$+=H,N+=E,G+=F.width2d}this.drawScanline(L>>16,$>>16,F.pixels,G,J),$+=H,L+=T,G+=F.width2d}}}else{if(N=L<<=16,G<0)N-=H*G,L-=T*G,G=0;if($<<=16,Q<0)$-=E*Q,Q=0;if(G!==Q&&H<T||G===Q&&E>T){m-=Q,Q-=G,G=this.lineOffset[G];while(!0){if(Q--,Q<0)while(!0){if(m--,m<0)return;this.drawScanline($>>16,L>>16,F.pixels,G,J),$+=E,L+=T,G+=F.width2d}this.drawScanline(N>>16,L>>16,F.pixels,G,J),N+=H,L+=T,G+=F.width2d}}else{m-=Q,Q-=G,G=this.lineOffset[G];while(!0){if(Q--,Q<0)while(!0){if(m--,m<0)return;this.drawScanline(L>>16,$>>16,F.pixels,G,J),$+=E,L+=T,G+=F.width2d}this.drawScanline(L>>16,N>>16,F.pixels,G,J),N+=H,L+=T,G+=F.width2d}}}}}else if(m<=Q){if(m<F.bottom){if(Q>F.bottom)Q=F.bottom;if(G>F.bottom)G=F.bottom;if(Q<G){if(L=N<<=16,m<0)L-=T*m,N-=E*m,m=0;if($<<=16,Q<0)$-=H*Q,Q=0;if(m!==Q&&T<E||m===Q&&T>H){G-=Q,Q-=m,m=this.lineOffset[m];while(!0){if(Q--,Q<0)while(!0){if(G--,G<0)return;this.drawScanline(L>>16,$>>16,F.pixels,m,J),L+=T,$+=H,m+=F.width2d}this.drawScanline(L>>16,N>>16,F.pixels,m,J),L+=T,N+=E,m+=F.width2d}}else{G-=Q,Q-=m,m=this.lineOffset[m];while(!0){if(Q--,Q<0)while(!0){if(G--,G<0)return;this.drawScanline($>>16,L>>16,F.pixels,m,J),L+=T,$+=H,m+=F.width2d}this.drawScanline(N>>16,L>>16,F.pixels,m,J),L+=T,N+=E,m+=F.width2d}}}else{if($=N<<=16,m<0)$-=T*m,N-=E*m,m=0;if(L<<=16,G<0)L-=H*G,G=0;if(T<E){Q-=G,G-=m,m=this.lineOffset[m];while(!0){if(G--,G<0)while(!0){if(Q--,Q<0)return;this.drawScanline(L>>16,N>>16,F.pixels,m,J),L+=H,N+=E,m+=F.width2d}this.drawScanline($>>16,N>>16,F.pixels,m,J),$+=T,N+=E,m+=F.width2d}}else{Q-=G,G-=m,m=this.lineOffset[m];while(!0){if(G--,G<0)while(!0){if(Q--,Q<0)return;this.drawScanline(N>>16,L>>16,F.pixels,m,J),L+=H,N+=E,m+=F.width2d}this.drawScanline(N>>16,$>>16,F.pixels,m,J),$+=T,N+=E,m+=F.width2d}}}}}else if(Q<F.bottom){if(G>F.bottom)G=F.bottom;if(m>F.bottom)m=F.bottom;if(G<m){if(N=$<<=16,Q<0)N-=E*Q,$-=H*Q,Q=0;if(L<<=16,G<0)L-=T*G,G=0;if(E<H){m-=G,G-=Q,Q=this.lineOffset[Q];while(!0){if(G--,G<0)while(!0){if(m--,m<0)return;this.drawScanline(N>>16,L>>16,F.pixels,Q,J),N+=E,L+=T,Q+=F.width2d}this.drawScanline(N>>16,$>>16,F.pixels,Q,J),N+=E,$+=H,Q+=F.width2d}}else{m-=G,G-=Q,Q=this.lineOffset[Q];while(!0){if(G--,G<0)while(!0){if(m--,m<0)return;this.drawScanline(L>>16,N>>16,F.pixels,Q,J),N+=E,L+=T,Q+=F.width2d}this.drawScanline($>>16,N>>16,F.pixels,Q,J),N+=E,$+=H,Q+=F.width2d}}}else{if(L=$<<=16,Q<0)L-=E*Q,$-=H*Q,Q=0;if(N<<=16,m<0)N-=T*m,m=0;if(E<H){G-=m,m-=Q,Q=this.lineOffset[Q];while(!0){if(m--,m<0)while(!0){if(G--,G<0)return;this.drawScanline(N>>16,$>>16,F.pixels,Q,J),N+=T,$+=H,Q+=F.width2d}this.drawScanline(L>>16,$>>16,F.pixels,Q,J),L+=E,$+=H,Q+=F.width2d}}else{G-=m,m-=Q,Q=this.lineOffset[Q];while(!0){if(m--,m<0)while(!0){if(G--,G<0)return;this.drawScanline($>>16,N>>16,F.pixels,Q,J),N+=T,$+=H,Q+=F.width2d}this.drawScanline($>>16,L>>16,F.pixels,Q,J),L+=E,$+=H,Q+=F.width2d}}}}}static fillTexturedTriangle(L,N,$,G,m,Q,J,T,E,H,Z,q,W,M,I,U,j,_,X){let k=this.getTexels(X);this.opaque=!this.textureTranslucent[X];let u=H-W,b=Z-I,O=q-j,n=M-H,V=U-Z,d=_-q,z=n*Z-V*H<<14,P=V*q-d*Z<<8,S=d*H-n*q<<5,Y=u*Z-b*H<<14,l=b*q-O*Z<<8,g=O*H-u*q<<5,K=b*n-u*V<<14,i=O*V-b*d<<8,p=u*d-O*n<<5,B=0,f=0;if(m!==G)B=(N-L<<16)/(m-G)|0,f=(T-J<<16)/(m-G)|0;let A=0,c=0;if(Q!==m)A=($-N<<16)/(Q-m)|0,c=(E-T<<16)/(Q-m)|0;let C=0,s=0;if(Q!==G)C=(L-$<<16)/(G-Q)|0,s=(J-E<<16)/(G-Q)|0;if(G<=m&&G<=Q){if(G<F.bottom){if(m>F.bottom)m=F.bottom;if(Q>F.bottom)Q=F.bottom;if(m<Q){if($=L<<=16,E=J<<=16,G<0)$-=C*G,L-=B*G,E-=s*G,J-=f*G,G=0;if(N<<=16,T<<=16,m<0)N-=A*m,T-=c*m,m=0;let r=G-this.centerY;if(z+=S*r,Y+=g*r,K+=p*r,z|=0,Y|=0,K|=0,G!==m&&C<B||G===m&&C>A){Q-=m,m-=G,G=this.lineOffset[G];while(!0){if(m--,m<0)while(!0){if(Q--,Q<0)return;this.drawTexturedScanline($>>16,N>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,E>>8,T>>8),$+=C,N+=A,E+=s,T+=c,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline($>>16,L>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,E>>8,J>>8),$+=C,L+=B,E+=s,J+=f,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}else{Q-=m,m-=G,G=this.lineOffset[G];while(!0){if(m--,m<0)while(!0){if(Q--,Q<0)return;this.drawTexturedScanline(N>>16,$>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,T>>8,E>>8),$+=C,N+=A,E+=s,T+=c,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(L>>16,$>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,J>>8,E>>8),$+=C,L+=B,E+=s,J+=f,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}}else{if(N=L<<=16,T=J<<=16,G<0)N-=C*G,L-=B*G,T-=s*G,J-=f*G,G=0;if($<<=16,E<<=16,Q<0)$-=A*Q,E-=c*Q,Q=0;let r=G-this.centerY;if(z+=S*r,Y+=g*r,K+=p*r,z|=0,Y|=0,K|=0,(G===Q||C>=B)&&(G!==Q||A<=B)){m-=Q,Q-=G,G=this.lineOffset[G];while(!0){if(Q--,Q<0)while(!0){if(m--,m<0)return;this.drawTexturedScanline(L>>16,$>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,J>>8,E>>8),$+=A,L+=B,E+=c,J+=f,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(L>>16,N>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,J>>8,T>>8),N+=C,L+=B,T+=s,J+=f,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}else{m-=Q,Q-=G,G=this.lineOffset[G];while(!0){if(Q--,Q<0)while(!0){if(m--,m<0)return;this.drawTexturedScanline($>>16,L>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,E>>8,J>>8),$+=A,L+=B,E+=c,J+=f,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(N>>16,L>>16,F.pixels,G,k,0,0,z,Y,K,P,l,i,T>>8,J>>8),N+=C,L+=B,T+=s,J+=f,G+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}}}}else if(m<=Q){if(m<F.bottom){if(Q>F.bottom)Q=F.bottom;if(G>F.bottom)G=F.bottom;if(Q<G){if(L=N<<=16,J=T<<=16,m<0)L-=B*m,N-=A*m,J-=f*m,T-=c*m,m=0;if($<<=16,E<<=16,Q<0)$-=C*Q,E-=s*Q,Q=0;let r=m-this.centerY;if(z+=S*r,Y+=g*r,K+=p*r,z|=0,Y|=0,K|=0,m!==Q&&B<A||m===Q&&B>C){G-=Q,Q-=m,m=this.lineOffset[m];while(!0){if(Q--,Q<0)while(!0){if(G--,G<0)return;this.drawTexturedScanline(L>>16,$>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,J>>8,E>>8),L+=B,$+=C,J+=f,E+=s,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(L>>16,N>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,J>>8,T>>8),L+=B,N+=A,J+=f,T+=c,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}else{G-=Q,Q-=m,m=this.lineOffset[m];while(!0){if(Q--,Q<0)while(!0){if(G--,G<0)return;this.drawTexturedScanline($>>16,L>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,E>>8,J>>8),L+=B,$+=C,J+=f,E+=s,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(N>>16,L>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,T>>8,J>>8),L+=B,N+=A,J+=f,T+=c,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}}else{if($=N<<=16,E=T<<=16,m<0)$-=B*m,N-=A*m,E-=f*m,T-=c*m,m=0;if(L<<=16,J<<=16,G<0)L-=C*G,J-=s*G,G=0;let r=m-this.centerY;if(z+=S*r,Y+=g*r,K+=p*r,z|=0,Y|=0,K|=0,Q-=G,G-=m,m=this.lineOffset[m],B<A)while(!0){if(G--,G<0)while(!0){if(Q--,Q<0)return;this.drawTexturedScanline(L>>16,N>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,J>>8,T>>8),L+=C,N+=A,J+=s,T+=c,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline($>>16,N>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,E>>8,T>>8),$+=B,N+=A,E+=f,T+=c,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}else while(!0){if(G--,G<0)while(!0){if(Q--,Q<0)return;this.drawTexturedScanline(N>>16,L>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,T>>8,J>>8),L+=C,N+=A,J+=s,T+=c,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(N>>16,$>>16,F.pixels,m,k,0,0,z,Y,K,P,l,i,T>>8,E>>8),$+=B,N+=A,E+=f,T+=c,m+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}}}else if(Q<F.bottom){if(G>F.bottom)G=F.bottom;if(m>F.bottom)m=F.bottom;if(G<m){if(N=$<<=16,T=E<<=16,Q<0)N-=A*Q,$-=C*Q,T-=c*Q,E-=s*Q,Q=0;if(L<<=16,J<<=16,G<0)L-=B*G,J-=f*G,G=0;let r=Q-this.centerY;if(z+=S*r,Y+=g*r,K+=p*r,z|=0,Y|=0,K|=0,m-=G,G-=Q,Q=this.lineOffset[Q],A<C)while(!0){if(G--,G<0)while(!0){if(m--,m<0)return;this.drawTexturedScanline(N>>16,L>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,T>>8,J>>8),N+=A,L+=B,T+=c,J+=f,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(N>>16,$>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,T>>8,E>>8),N+=A,$+=C,T+=c,E+=s,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}else while(!0){if(G--,G<0)while(!0){if(m--,m<0)return;this.drawTexturedScanline(L>>16,N>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,J>>8,T>>8),N+=A,L+=B,T+=c,J+=f,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline($>>16,N>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,E>>8,T>>8),N+=A,$+=C,T+=c,E+=s,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}else{if(L=$<<=16,J=E<<=16,Q<0)L-=A*Q,$-=C*Q,J-=c*Q,E-=s*Q,Q=0;if(N<<=16,T<<=16,m<0)N-=B*m,T-=f*m,m=0;let r=Q-this.centerY;if(z+=S*r,Y+=g*r,K+=p*r,z|=0,Y|=0,K|=0,G-=m,m-=Q,Q=this.lineOffset[Q],A<C)while(!0){if(m--,m<0)while(!0){if(G--,G<0)return;this.drawTexturedScanline(N>>16,$>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,T>>8,E>>8),N+=B,$+=C,T+=f,E+=s,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline(L>>16,$>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,J>>8,E>>8),L+=A,$+=C,J+=c,E+=s,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}else while(!0){if(m--,m<0)while(!0){if(G--,G<0)return;this.drawTexturedScanline($>>16,N>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,E>>8,T>>8),N+=B,$+=C,T+=f,E+=s,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}this.drawTexturedScanline($>>16,L>>16,F.pixels,Q,k,0,0,z,Y,K,P,l,i,E>>8,J>>8),L+=A,$+=C,J+=c,E+=s,Q+=F.width2d,z+=S,Y+=g,K+=p,z|=0,Y|=0,K|=0}}}}static drawTexturedScanline(L,N,$,G,m,Q,J,T,E,H,Z,q,W,M,I){if(L>=N)return;let U,j;if(this.clipX){if(U=(I-M)/(N-L)|0,N>F.boundX)N=F.boundX;if(L<0)M-=L*U,L=0;if(L>=N)return;j=N-L>>3,U<<=12}else if(N-L>7)j=N-L>>3,U=(I-M)*this.reciprocal15[j]>>6;else j=0,U=0;M<<=9,G+=L;let _,X,k,u,b,O,n;if(this.lowMemory&&m){if(_=0,X=0,u=L-this.centerX,T=T+(Z>>3)*u,E=E+(q>>3)*u,H=H+(W>>3)*u,T|=0,E|=0,H|=0,k=H>>12,k!==0){if(Q=T/k|0,J=E/k|0,Q<0)Q=0;else if(Q>4032)Q=4032}if(T=T+Z,E=E+q,H=H+W,T|=0,E|=0,H|=0,k=H>>12,k!==0){if(_=T/k|0,X=E/k|0,_<7)_=7;else if(_>4032)_=4032}if(b=_-Q>>3,O=X-J>>3,Q+=M>>3&786432,n=M>>23,this.opaque){while(j-- >0){if($[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O,$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q=_,J=X,T+=Z,E+=q,H+=W,k=H>>12,k!==0){if(_=T/k|0,X=E/k|0,_<7)_=7;else if(_>4032)_=4032}b=_-Q>>3,O=X-J>>3,M+=U,Q+=M>>3&786432,n=M>>23}j=N-L&7;while(j-- >0)$[G++]=m[(J&4032)+(Q>>6)]>>>n,Q+=b,J+=O}else{while(j-- >0){let V;if((V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G=G+1,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;if(G=G+1,Q=_,J=X,T+=Z,E+=q,H+=W,T|=0,E|=0,H|=0,k=H>>12,k!==0){if(_=T/k|0,X=E/k|0,_<7)_=7;else if(_>4032)_=4032}b=_-Q>>3,O=X-J>>3,M+=U,Q+=M>>3&786432,n=M>>23}j=N-L&7;while(j-- >0){let V;if((V=m[(J&4032)+(Q>>6)]>>>n)!==0)$[G]=V;G++,Q+=b,J+=O}}return}if(_=0,X=0,u=L-this.centerX,T=T+(Z>>3)*u,E=E+(q>>3)*u,H=H+(W>>3)*u,T|=0,E|=0,H|=0,k=H>>14,k!==0){if(Q=T/k|0,J=E/k|0,Q<0)Q=0;else if(Q>16256)Q=16256}if(T=T+Z,E=E+q,H=H+W,T|=0,E|=0,H|=0,k=H>>14,k!==0){if(_=T/k|0,X=E/k|0,_<7)_=7;else if(_>16256)_=16256}if(b=_-Q>>3,O=X-J>>3,Q+=M&6291456,n=M>>23,this.opaque&&m){while(j-- >0){if($[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O,$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q=_,J=X,T+=Z,E+=q,H+=W,T|=0,E|=0,H|=0,k=H>>14,k!==0){if(_=T/k|0,X=E/k|0,_<7)_=7;else if(_>16256)_=16256}b=_-Q>>3,O=X-J>>3,M+=U,Q+=M&6291456,n=M>>23}j=N-L&7;while(j-- >0)$[G++]=m[(J&16256)+(Q>>7)]>>>n,Q+=b,J+=O;return}while(j-- >0&&m){let V;if((V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G=G+1,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q+=b,J+=O,(V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;if(G++,Q=_,J=X,T+=Z,E+=q,H+=W,T|=0,E|=0,H|=0,k=H>>14,k!==0){if(_=T/k|0,X=E/k|0,_<7)_=7;else if(_>16256)_=16256}b=_-Q>>3,O=X-J>>3,M+=U,Q+=M&6291456,n=M>>23}j=N-L&7;while(j-- >0&&m){let V;if((V=m[(J&16256)+(Q>>7)]>>>n)!==0)$[G]=V;G++,Q+=b,J+=O}}static drawScanline(L,N,$,G,m){if(this.clipX){if(N>F.boundX)N=F.boundX;if(L<0)L=0}if(L>=N)return;G+=L;let Q=N-L>>2;if(this.alpha===0)while(!0){if(Q--,Q<0){Q=N-L&3;while(!0){if(Q--,Q<0)return;$[G++]=m}}$[G++]=m,$[G++]=m,$[G++]=m,$[G++]=m}let J=this.alpha,T=256-this.alpha;m=((m&16711935)*T>>8&16711935)+((m&65280)*T>>8&65280);while(!0){if(Q--,Q<0){Q=N-L&3;while(!0){if(Q--,Q<0)return;$[G++]=m+(($[G]&16711935)*J>>8&16711935)+(($[G]&65280)*J>>8&65280)}}$[G++]=m+(($[G]&16711935)*J>>8&16711935)+(($[G]&65280)*J>>8&65280),$[G++]=m+(($[G]&16711935)*J>>8&16711935)+(($[G]&65280)*J>>8&65280),$[G++]=m+(($[G]&16711935)*J>>8&16711935)+(($[G]&65280)*J>>8&65280),$[G++]=m+(($[G]&16711935)*J>>8&16711935)+(($[G]&65280)*J>>8&65280)}}static pushTexture(L){if(this.activeTexels[L]&&this.texelPool)this.texelPool[this.poolSize++]=this.activeTexels[L],this.activeTexels[L]=null}static getTexels(L){if(this.textureCycle[L]=this.cycle++,this.activeTexels[L])return this.activeTexels[L];let N;if(this.poolSize>0&&this.texelPool)N=this.texelPool[--this.poolSize],this.texelPool[this.poolSize]=null;else{let m=0,Q=-1;for(let J=0;J<this.textureCount;J++)if(this.activeTexels[J]&&(this.textureCycle[J]<m||Q===-1))m=this.textureCycle[J],Q=J;N=this.activeTexels[Q],this.activeTexels[Q]=null}this.activeTexels[L]=N;let $=this.textures[L],G=this.texPal[L];if(!N||!$||!G)return null;if(this.lowMemory){this.textureTranslucent[L]=!1;for(let m=0;m<4096;m++){let Q=N[m]=G[$.pixels[m]]&16316671;if(Q===0)this.textureTranslucent[L]=!0;N[m+4096]=Q-(Q>>>3)&16316671,N[m+8192]=Q-(Q>>>2)&16316671,N[m+12288]=Q-(Q>>>2)-(Q>>>3)&16316671}}else{if($.width2d===64)for(let m=0;m<128;m++)for(let Q=0;Q<128;Q++)N[Q+(m<<7|0)]=G[$.pixels[(Q>>1)+(m>>1<<6|0)]];else for(let m=0;m<16384;m++)N[m]=G[$.pixels[m]];this.textureTranslucent[L]=!1;for(let m=0;m<16384;m++){N[m]&=16316671;let Q=N[m];if(Q===0)this.textureTranslucent[L]=!0;N[m+16384]=Q-(Q>>>3)&16316671,N[m+32768]=Q-(Q>>>2)&16316671,N[m+49152]=Q-(Q>>>2)-(Q>>>3)&16316671}}return N}}class I0{image;width2d;height2d;ctx;paint;pixels;constructor(L,N,$=w){this.ctx=$,this.image=this.ctx.getImageData(0,0,L,N),this.paint=new Uint32Array(this.image.data.buffer),this.pixels=new Int32Array(L*N),this.width2d=L,this.height2d=N,this.bind()}clear(){this.pixels.fill(0)}bind(){F.bind(this.pixels,this.width2d,this.height2d)}draw(L,N){this.#L(),this.ctx.putImageData(this.image,L,N)}#L(){let L=this.pixels.length,N=this.pixels,$=this.paint;for(let G=0;G<L;G++){let m=N[G];$[G]=m>>16&255|(m>>8&255)<<8|(m&255)<<16|4278190080}}}var W0=["q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","Shift","z","x","c","v","b","n","m","Del","123",","," ",".","Enter"],D0=["Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","Shift","Z","X","C","V","B","N","M","Del","123",","," ",".","Enter"],P0=["1","2","3","4","5","6","7","8","9","0","!",'"',"$","%","_","&","*","(",")","1/2","@","=","<",">","~",";",":","Del","abc","#"," ","?","Enter"],w0=["£","^","[","]","{","}","'","-","+","/","\\","|","","","","","","","","2/2","","","","","","","","Del","abc",""," ","","Enter"],m0=[0,10,19,28],e=50,Z0=30,S0=1000,K0=5,U0=75;function g0(){return document.fullscreenElement!==null}class n0{canvasKeyboard;nativeKeyboard;mode;constructor(){this.canvasKeyboard=new O0,this.nativeKeyboard=new V0;let L=localStorage.getItem("mobileKeyboardMode");if(L==="native")this.mode=1;else if(L==="canvas")this.mode=2;else this.mode=0}show(L,N){if(this.mode===0)if(g0())this.canvasKeyboard.show(L,N);else this.nativeKeyboard.show(L,N);else if(this.mode===2)this.canvasKeyboard.show(L,N);else if(this.mode===1)this.nativeKeyboard.show(L,N)}hide(){this.canvasKeyboard.hide(),this.nativeKeyboard.hide()}draw(){this.canvasKeyboard.draw()}isDisplayed(){return this.canvasKeyboard.isDisplayed()||this.nativeKeyboard.isDisplayed()}isWithinCanvasKeyboard(L,N){return this.canvasKeyboard.isDisplayed()&&this.canvasKeyboard.posWithinKeyboard(L,N)}captureMouseUp(L,N){if(this.canvasKeyboard.isDisplayed())return this.canvasKeyboard.captureMouseUp(L,N);else if(this.nativeKeyboard.isDisplayed())return this.nativeKeyboard.captureMouseUp(L,N);return!1}captureMouseDown(L,N){if(this.canvasKeyboard.isDisplayed())return this.canvasKeyboard.captureMouseDown(L,N);else if(this.nativeKeyboard.isDisplayed())return this.nativeKeyboard.captureMouseDown(L,N);return!1}notifyTouchMove(L,N){if(this.canvasKeyboard.isDisplayed())this.canvasKeyboard.notifyTouchMove(L,N);else if(this.nativeKeyboard.isDisplayed())this.nativeKeyboard.notifyTouchMove(L,N)}}class O0{displayed=!1;height=Z0*4+10;width=e*10+10;startX=0;startY=503-this.height;mode=0;animateBoxIndex=-1;animateBoxTimeout=0;touchStartAtX=0;touchStartAtY=0;touching=!1;touchStartTimestamp=0;getBoxColorForIndex(L){if(this.animateBoxIndex>-1){if(this.animateBoxIndex===L)return"#a6a6a6"}let N=this.getCharForIndex(L);if(N!==void 0&&N.length>1)return"#a9afba";return"#c8cdd1"}getBoxForIndex(L){let N=L<m0[1]?0:L<m0[2]?1:L<m0[3]?2:3,G={startX:(L-m0[N])*e+5,startY:N*Z0+5,width:e,height:Z0};if(N===1)G.startX+=e/2;if(L===30)G.width*=6;if(L>30)G.startX+=e*5;return G}getCharForIndex(L){if(this.mode===1)return D0[L];else if(this.mode===2)return P0[L];else if(this.mode===3)return w0[L];return W0[L]}drawKeyBoxes(){for(let L=0;L<W0.length;L++){let N=this.getBoxForIndex(L);w.fillStyle=this.getBoxColorForIndex(L),w.beginPath(),w.roundRect(this.startX+N.startX+2,this.startY+N.startY+2,N.width-2,N.height-2,5),w.fill()}}drawKeyChars(){w.fillStyle="black",w.textAlign="center",w.textBaseline="middle";for(let L=0;L<W0.length;L++){w.font="16px Roboto, sans-serif";let N=this.getBoxForIndex(L),$=this.startX+N.startX+e/2,G=this.startY+N.startY+Z0/2+2,m=this.getCharForIndex(L);if(m.length>1)w.font="14px Roboto, sans-serif";w.fillText(m,$,G)}}drawBackground(){w.fillStyle="#dadde2",w.beginPath(),w.roundRect(this.startX,this.startY,this.width,this.height,5),w.fill()}draw(){if(!this.isDisplayed())return;w.save(),this.drawBackground(),this.drawKeyBoxes(),this.drawKeyChars(),w.restore()}show(L,N){this.mode=0,this.displayed=!0}hide(){this.displayed=!1}isDisplayed(){return this.displayed}posWithinKeyboard(L,N){let $=L>=this.startX&&L<this.startX+this.width,G=N>=this.startY&&N<this.startY+this.height;return $&&G}getBoxIndexForClick(L,N){let $=L-this.startX,G=N-this.startY;if($<0||G<0||$>=this.width||G>=this.height)return-1;let m=Math.floor(G/Z0),Q=Math.floor($/e);if(m===0)return Q;if(m===1){if($<e/2||$>this.width-e/2)return-1;return m0[1]+Math.floor(($-e/2)/e)}if(m===2){if(Q>=9)return-1;return m0[2]+Q}return m0[3]+Q}getCharForClick(L,N){let $=this.getBoxIndexForClick(L,N);if($>-1){let G="";if($>=30&&$<=35)G=" ";else if($===36)G=this.getCharForIndex(31);else if($===37)G="Enter";else G=this.getCharForIndex($);if(G==="Del")G="Backspace";return G}return""}captureMouseDown(L,N){if(this.posWithinKeyboard(L,N))return!0;return!1}captureMouseUp(L,N){if(this.touching=!1,this.posWithinKeyboard(L,N)){let $=this.getBoxIndexForClick(L,N),G=this.getCharForClick(L,N);if(G==="Shift"){if(this.mode===0)this.mode=1;else this.mode=0;return!0}else if(G==="123"||G==="2/2")return this.mode=2,!0;else if(G==="1/2")return this.mode=3,!0;else if(G==="abc")return this.mode=0,!0;else if(G==="")return!0;let m=new KeyboardEvent("keydown",{key:G,code:G}),Q=new KeyboardEvent("keyup",{key:G,code:G});if(D.dispatchEvent(m),D.dispatchEvent(Q),!this.animateBoxTimeout){if($>=30&&$<=35)this.animateBoxIndex=30;else if($>35)this.animateBoxIndex=$-5;else this.animateBoxIndex=$;this.animateBoxTimeout=window.setTimeout(()=>{this.animateBoxIndex=-1,this.animateBoxTimeout=0},100)}return!0}return!1}notifyTouchMove(L,N){if(!this.posWithinKeyboard(L,N))return;if(this.touching&&performance.now()>this.touchStartTimestamp+S0){this.touching=!1;return}if(!this.touching){this.touching=!0,this.touchStartTimestamp=performance.now(),this.touchStartAtX=L-this.startX,this.touchStartAtY=N-this.startY;return}let $=Math.abs(Math.abs(this.touchStartAtX-L)-this.startX),G=Math.abs(Math.abs(this.touchStartAtY-N)-this.startY);if($>U0||G>U0)return;if($>K0||G>K0){let m=Math.max(0,Math.min(789-this.width,L-this.touchStartAtX)),Q=Math.max(0,Math.min(532-this.height,N-this.touchStartAtY));this.startX=m,this.startY=Q,D.dispatchEvent(new FocusEvent("focus"))}}}class V0{virtualInputElement;displayed=!1;isAndroid=!1;constructor(){if(this.isAndroid=navigator.userAgent.includes("Android"),this.virtualInputElement=document.createElement("input"),this.virtualInputElement.setAttribute("type","password"),this.virtualInputElement.setAttribute("autofocus","autofocus"),this.virtualInputElement.setAttribute("spellcheck","false"),this.virtualInputElement.setAttribute("autocomplete","off"),this.virtualInputElement.setAttribute("style","position: fixed; top: 0px; left: 0px; width: 1px; height: 1px; opacity: 0;"),this.isAndroid)this.virtualInputElement.addEventListener("input",(L)=>{if(!(L instanceof InputEvent))return;let N=L.data;if(N===null)return;if(L.inputType!=="insertText")return;D.dispatchEvent(new KeyboardEvent("keydown",{key:N,code:N})),D.dispatchEvent(new KeyboardEvent("keyup",{key:N,code:N}))}),this.virtualInputElement.addEventListener("keydown",(L)=>{if(L.key==="Enter"||L.key==="Backspace")D.dispatchEvent(new KeyboardEvent("keydown",{key:L.key,code:L.key}))}),this.virtualInputElement.addEventListener("keyup",(L)=>{if(L.key==="Enter"||L.key==="Backspace")D.dispatchEvent(new KeyboardEvent("keyup",{key:L.key,code:L.key}))});else this.virtualInputElement.addEventListener("keydown",(L)=>{D.dispatchEvent(new KeyboardEvent("keydown",{key:L.key,code:L.key}))}),this.virtualInputElement.addEventListener("keyup",(L)=>{D.dispatchEvent(new KeyboardEvent("keyup",{key:L.key,code:L.key}))});document.body.appendChild(this.virtualInputElement)}draw(){}show(L,N){if(L&&N)this.virtualInputElement.style.left=`${L}px`,this.virtualInputElement.style.top=`${N}px`;D.blur(),this.virtualInputElement.focus(),this.virtualInputElement.click(),this.displayed=!0}hide(){this.virtualInputElement.blur(),D.focus(),this.displayed=!1}isDisplayed(){return this.displayed}captureMouseUp(L,N){return!1}captureMouseDown(L,N){return!1}notifyTouchMove(L,N){return}}var y=new n0;var z0=["F11","F12"],R=new Map;R.set("ArrowLeft",{code:37,ch:1});R.set("ArrowRight",{code:39,ch:2});R.set("ArrowUp",{code:38,ch:3});R.set("ArrowDown",{code:40,ch:4});R.set("Control",{code:17,ch:5});R.set("Shift",{code:16,ch:6});R.set("Alt",{code:18,ch:7});R.set("Backspace",{code:8,ch:8});R.set("Tab",{code:9,ch:9});R.set("Enter",{code:10,ch:10});R.set("Escape",{code:27,ch:27});R.set(" ",{code:32,ch:32});R.set("Delete",{code:127,ch:127});R.set("Home",{code:36,ch:1000});R.set("End",{code:35,ch:1001});R.set("PageUp",{code:33,ch:1002});R.set("PageDown",{code:34,ch:1003});R.set("F1",{code:112,ch:1008});R.set("F2",{code:113,ch:1009});R.set("F3",{code:114,ch:1010});R.set("F4",{code:115,ch:1011});R.set("F5",{code:116,ch:1012});R.set("F6",{code:117,ch:1013});R.set("F7",{code:118,ch:1014});R.set("F8",{code:119,ch:1015});R.set("F9",{code:120,ch:1016});R.set("F10",{code:121,ch:1017});R.set("F11",{code:122,ch:1018});R.set("F12",{code:123,ch:1019});R.set("CapsLock",{code:20,ch:65535});R.set("Meta",{code:524,ch:65535});R.set("Insert",{code:155,ch:65535});R.set("`",{code:192,ch:96});R.set("~",{code:192,ch:126});R.set("!",{code:49,ch:33});R.set("@",{code:50,ch:64});R.set("#",{code:51,ch:35});R.set("£",{code:51,ch:163});R.set("$",{code:52,ch:36});R.set("%",{code:53,ch:37});R.set("^",{code:54,ch:94});R.set("&",{code:55,ch:38});R.set("*",{code:56,ch:42});R.set("(",{code:57,ch:40});R.set(")",{code:48,ch:41});R.set("-",{code:45,ch:45});R.set("_",{code:45,ch:95});R.set("=",{code:61,ch:61});R.set("+",{code:61,ch:43});R.set("[",{code:91,ch:91});R.set("{",{code:91,ch:123});R.set("]",{code:93,ch:93});R.set("}",{code:93,ch:125});R.set("\\",{code:92,ch:92});R.set("|",{code:92,ch:124});R.set(";",{code:59,ch:59});R.set(":",{code:59,ch:58});R.set("'",{code:222,ch:39});R.set('"',{code:222,ch:34});R.set(",",{code:44,ch:44});R.set("<",{code:44,ch:60});R.set(".",{code:46,ch:46});R.set(">",{code:46,ch:62});R.set("/",{code:47,ch:47});R.set("?",{code:47,ch:63});R.set("0",{code:48,ch:48});R.set("1",{code:49,ch:49});R.set("2",{code:50,ch:50});R.set("3",{code:51,ch:51});R.set("4",{code:52,ch:52});R.set("5",{code:53,ch:53});R.set("6",{code:54,ch:54});R.set("7",{code:55,ch:55});R.set("8",{code:56,ch:56});R.set("9",{code:57,ch:57});R.set("a",{code:65,ch:97});R.set("b",{code:66,ch:98});R.set("c",{code:67,ch:99});R.set("d",{code:68,ch:100});R.set("e",{code:69,ch:101});R.set("f",{code:70,ch:102});R.set("g",{code:71,ch:103});R.set("h",{code:72,ch:104});R.set("i",{code:73,ch:105});R.set("j",{code:74,ch:106});R.set("k",{code:75,ch:107});R.set("l",{code:76,ch:108});R.set("m",{code:77,ch:109});R.set("n",{code:78,ch:110});R.set("o",{code:79,ch:111});R.set("p",{code:80,ch:112});R.set("q",{code:81,ch:113});R.set("r",{code:82,ch:114});R.set("s",{code:83,ch:115});R.set("t",{code:84,ch:116});R.set("u",{code:85,ch:117});R.set("v",{code:86,ch:118});R.set("w",{code:87,ch:119});R.set("x",{code:88,ch:120});R.set("y",{code:89,ch:121});R.set("z",{code:90,ch:122});R.set("A",{code:65,ch:65});R.set("B",{code:66,ch:66});R.set("C",{code:67,ch:67});R.set("D",{code:68,ch:68});R.set("E",{code:69,ch:69});R.set("F",{code:70,ch:70});R.set("G",{code:71,ch:71});R.set("H",{code:72,ch:72});R.set("I",{code:73,ch:73});R.set("J",{code:74,ch:74});R.set("K",{code:75,ch:75});R.set("L",{code:76,ch:76});R.set("M",{code:77,ch:77});R.set("N",{code:78,ch:78});R.set("O",{code:79,ch:79});R.set("P",{code:80,ch:80});R.set("Q",{code:81,ch:81});R.set("R",{code:82,ch:82});R.set("S",{code:83,ch:83});R.set("T",{code:84,ch:84});R.set("U",{code:85,ch:85});R.set("V",{code:86,ch:86});R.set("W",{code:87,ch:87});R.set("X",{code:88,ch:88});R.set("Y",{code:89,ch:89});R.set("Z",{code:90,ch:90});class a{static enabled=!1;static outBuffer=null;static oldBuffer=null;static lastTime=0;static trackedCount=0;static lastMoveTime=0;static lastX=0;static lastY=0;static setEnabled(){this.outBuffer=v.alloc(1),this.oldBuffer=null,this.lastTime=performance.now(),this.enabled=!0}static setDisabled(){this.enabled=!1,this.outBuffer=null,this.oldBuffer=null}static flush(){let L=null;if(this.oldBuffer&&this.enabled)L=this.oldBuffer;return this.oldBuffer=null,L}static stop(){let L=null;if(this.outBuffer&&this.outBuffer.pos>0&&this.enabled)L=this.outBuffer;return this.setDisabled(),L}static ensureCapacity(L){if(!this.outBuffer)return;if(this.outBuffer.pos+L>=500){let N=this.outBuffer;this.outBuffer=v.alloc(1),this.oldBuffer=N}}static mousePressed(L,N,$){if(!this.outBuffer)return;if(!this.enabled&&(L>=0&&L<789&&N>=0&&N<532))return;this.trackedCount++;let G=performance.now(),m=(G-this.lastTime)/10|0;if(m>250)m=250;if(this.lastTime=G,this.ensureCapacity(5),$===2)this.outBuffer.p1(1);else this.outBuffer.p1(2);this.outBuffer.p1(m),this.outBuffer.p3(L+(N<<10))}static mouseReleased(L){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let N=performance.now(),$=(N-this.lastTime)/10|0;if($>250)$=250;if(this.lastTime=N,this.ensureCapacity(2),L===2)this.outBuffer.p1(3);else this.outBuffer.p1(4);this.outBuffer.p1($)}static mouseMoved(L,N){if(!this.outBuffer)return;if(!this.enabled&&(L>=0&&L<789&&N>=0&&N<532))return;let $=performance.now();if($-this.lastMoveTime<50)return;this.lastMoveTime=$,this.trackedCount++;let G=($-this.lastTime)/10|0;if(G>250)G=250;if(this.lastTime=$,L-this.lastX<8&&L-this.lastX>=-8&&N-this.lastY<8&&N-this.lastY>=-8)this.ensureCapacity(3),this.outBuffer.p1(5),this.outBuffer.p1(G),this.outBuffer.p1(L+(N-this.lastY+8<<4)+8-this.lastX);else if(L-this.lastX<128&&L-this.lastX>=-128&&N-this.lastY<128&&N-this.lastY>=-128)this.ensureCapacity(4),this.outBuffer.p1(6),this.outBuffer.p1(G),this.outBuffer.p1(L+128-this.lastX),this.outBuffer.p1(N+128-this.lastY);else this.ensureCapacity(5),this.outBuffer.p1(7),this.outBuffer.p1(G),this.outBuffer.p3(L+(N<<10));this.lastX=L,this.lastY=N}static keyPressed(L){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let N=performance.now(),$=(N-this.lastTime)/10|0;if($>250)$=250;if(this.lastTime=N,L===1000)L=11;else if(L===1001)L=12;else if(L===1002)L=14;else if(L===1003)L=15;else if(L>=1008)L-=992;this.ensureCapacity(3),this.outBuffer.p1(8),this.outBuffer.p1($),this.outBuffer.p1(L)}static keyReleased(L){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let N=performance.now(),$=(N-this.lastTime)/10|0;if($>250)$=250;if(this.lastTime=N,L===1000)L=11;else if(L===1001)L=12;else if(L===1002)L=14;else if(L===1003)L=15;else if(L>=1008)L-=992;this.ensureCapacity(3),this.outBuffer.p1(9),this.outBuffer.p1($),this.outBuffer.p1(L)}static focusGained(){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let L=performance.now(),N=(L-this.lastTime)/10|0;if(N>250)N=250;this.lastTime=L,this.ensureCapacity(2),this.outBuffer.p1(10),this.outBuffer.p1(N)}static focusLost(){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let L=performance.now(),N=(L-this.lastTime)/10|0;if(N>250)N=250;this.lastTime=L,this.ensureCapacity(2),this.outBuffer.p1(11),this.outBuffer.p1(N)}static mouseEntered(){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let L=performance.now(),N=(L-this.lastTime)/10|0;if(N>250)N=250;this.lastTime=L,this.ensureCapacity(2),this.outBuffer.p1(12),this.outBuffer.p1(N)}static mouseExited(){if(!this.outBuffer)return;if(!this.enabled)return;this.trackedCount++;let L=performance.now(),N=(L-this.lastTime)/10|0;if(N>250)N=250;this.lastTime=L,this.ensureCapacity(2),this.outBuffer.p1(13),this.outBuffer.p1(N)}}class j0{state=0;deltime=20;mindel=1;otim=new Array(10);fps=0;debug=!1;drawArea=null;redrawScreen=!0;hasFocus=!0;idleCycles=performance.now();mouseButton=0;mouseX=-1;mouseY=-1;lastMouseClickButton=0;lastMouseClickX=0;lastMouseClickY=0;mouseClickButton=0;mouseClickX=-1;mouseClickY=-1;lastMouseClickTime=0;mouseClickTime=0;actionKey=[];keyQueue=[];keyQueueReadPos=0;keyQueueWritePos=0;slowestMS=0;averageMS=[];averageIndexMS=0;resizeToFit=!1;tfps=50;fpos=0;frameTime=[];ingame=!1;touching=!1;startedInViewport=!1;startedInTabArea=!1;time=-1;sx=0;sy=0;mx=0;my=0;nx=0;ny=0;async load(){}async update(){}async draw(){}async refresh(){}constructor(L=!1){if(D.tabIndex=-1,w.fillStyle="black",w.fillRect(0,0,D.width,D.height),this.resizeToFit=L,this.resizeToFit)this.resize(window.innerWidth,window.innerHeight);else this.resize(D.width,D.height)}get width(){return D.width}get height(){return D.height}resize(L,N){D.width=L,D.height=N,this.drawArea=new I0(L,N),h.init2D()}async run(){if(D.addEventListener("resize",()=>{if(this.resizeToFit)this.resize(window.innerWidth,window.innerHeight)},!1),D.onfocus=this.onfocus.bind(this),D.onblur=this.onblur.bind(this),D.onmousedown=this.onmousedown.bind(this),D.onmouseup=this.onmouseup.bind(this),D.onmouseenter=this.onmouseenter.bind(this),D.onmouseleave=this.onmouseleave.bind(this),D.onmousemove=this.onmousemove.bind(this),D.onkeydown=this.onkeydown.bind(this),D.onkeyup=this.onkeyup.bind(this),this.isMobile)D.ontouchstart=this.ontouchstart.bind(this),D.ontouchend=this.ontouchend.bind(this),D.ontouchmove=this.ontouchmove.bind(this);D.oncontextmenu=(Q)=>{Q.preventDefault()},window.oncontextmenu=(Q)=>{Q.preventDefault()},await this.drawProgress(0,"Loading..."),await this.load();let L=0,N=0,$=256,G=1,m=0;for(let Q=0;Q<10;Q++)this.otim[Q]=performance.now();while(this.state>=0){if(this.state>0){if(this.state--,this.state===0){this.shutdown();return}}let Q=$,J=G;$=300,G=1,L=performance.now();let T=this.otim[N];if(T===0)$=Q,G=J;else if(L>T)$=this.deltime*2560/(L-T)|0;if($<25)$=25;else if($>256)$=256,G=this.deltime-(L-T)/10|0;if(this.otim[N]=L,N=(N+1)%10,G>1){for(let H=0;H<10;H++)if(this.otim[H]!==0)this.otim[H]+=G}if(G<this.mindel)G=this.mindel;await E0(G);while(m<256)this.mouseClickButton=this.lastMouseClickButton,this.mouseClickX=this.lastMouseClickX,this.mouseClickY=this.lastMouseClickY,this.mouseClickTime=this.lastMouseClickTime,this.lastMouseClickButton=0,await this.update(),m+=$;if(m&=255,this.deltime>0)this.fps=$*1000/(this.deltime*256)|0;let E=performance.now();if(await this.draw(),this.isMobile)y.draw();if(this.frameTime[this.fpos]=(performance.now()-E)/1000,this.fpos=(this.fpos+1)%this.frameTime.length,this.tfps<50){let H=1000/this.tfps-(performance.now()-L);if(H>0)await E0(H)}if(this.debug){for(let H=0;H<10;H++){let Z=(N-H-1+20)%10}this.debug=!1}}if(this.state===-1)this.shutdown()}shutdown(){this.state=-2}setFramerate(L){this.deltime=1000/L|0}setTargetedFramerate(L){this.tfps=Math.max(Math.min(50,L|0),0)}start(){if(this.state>=0)this.state=0}stop(){if(this.state>=0)this.state=4000/this.deltime|0}async drawProgress(L,N){let $=this.width,G=this.height;if(this.redrawScreen)w.fillStyle="black",w.fillRect(0,0,$,G),this.redrawScreen=!1;let m=G/2-18;w.strokeStyle="rgb(140, 17, 17)",w.strokeRect(($/2|0)-152,m,304,34),w.fillStyle="rgb(140, 17, 17)",w.fillRect(($/2|0)-150,m+2,L*3,30),w.fillStyle="black",w.fillRect(($/2|0)-150+L*3,m+2,300-L*3,30),w.font="bold 13px helvetica, sans-serif",w.textAlign="center",w.fillStyle="white",w.fillText(N,$/2|0,m+22),await E0(5)}pollKey(){let L=-1;if(this.keyQueueWritePos!==this.keyQueueReadPos)L=this.keyQueue[this.keyQueueReadPos],this.keyQueueReadPos=this.keyQueueReadPos+1&127;return L}get ms(){let L=this.frameTime.length,N=0;for(let G=0;G<L;G++)N+=this.frameTime[G];let $=N/L*1000;if($>this.slowestMS)this.slowestMS=$;return this.averageMS[this.averageIndexMS]=$,this.averageIndexMS=(this.averageIndexMS+1)%250,$}get msAvg(){return this.averageMS.reduce((L,N)=>L+N,0)/250}onkeydown(L){this.idleCycles=performance.now();let N=R.get(L.key);if(!N||L.code.length===0&&!L.isTrusted)return;let $=N.ch;if(L.ctrlKey){if($>=65&&$<=93||$==95)$-=64;else if($>=97&&$<=122)$-=96}if($>0&&$<128)this.actionKey[$]=1;if($>4)this.keyQueue[this.keyQueueWritePos]=$,this.keyQueueWritePos=this.keyQueueWritePos+1&127;if(a.enabled)a.keyPressed($);if(!z0.includes(L.key))L.preventDefault()}onkeyup(L){this.idleCycles=performance.now();let N=R.get(L.key);if(!N||L.code.length===0&&!L.isTrusted)return;let $=N.ch;if(L.ctrlKey){if($>=65&&$<=93||$==95)$-=64;else if($>=97&&$<=122)$-=96}if($>0&&$<128)this.actionKey[$]=0;if(a.enabled)a.keyReleased($);if(!z0.includes(L.key))L.preventDefault()}onmousedown(L){if(this.touching=!1,L.clientX>0||L.clientY>0)this.setMousePosition(L);if(this.idleCycles=performance.now(),this.lastMouseClickX=this.mouseX,this.lastMouseClickY=this.mouseY,this.lastMouseClickTime=performance.now(),this.isMobile&&!this.isCapacitor){if(this.insideMobileInputArea()&&!this.insideUsernameArea()&&!this.inPasswordArea()&&!this.insideChatPopupArea()){this.lastMouseClickButton=1,this.mouseButton=1;return}if(L.timeStamp>=this.time+500)this.lastMouseClickButton=2,this.mouseButton=2;else this.lastMouseClickButton=1,this.mouseButton=1}else if(L.button===2)this.lastMouseClickButton=2,this.mouseButton=2;else if(L.button===0)this.lastMouseClickButton=1,this.mouseButton=1;if(y.isDisplayed()){if(y.captureMouseDown(this.mouseX,this.mouseY))this.mouseButton=0,this.mouseClickButton=0}if(a.enabled)a.mousePressed(this.lastMouseClickX,this.lastMouseClickY,L.button)}onmouseup(L){if(this.setMousePosition(L),this.idleCycles=performance.now(),this.mouseButton=0,this.isMobile){if(this.insideMobileInputArea()&&!y.isDisplayed())y.show(this.mouseX,this.mouseY);else if(y.isDisplayed()){if(!y.captureMouseUp(this.mouseX,this.mouseY))y.hide(),this.refresh()}}if(a.enabled)a.mouseReleased(L.button)}onmouseenter(L){if(this.setMousePosition(L),a.enabled)a.mouseEntered()}onmouseleave(L){if(this.setMousePosition(L),this.idleCycles=performance.now(),this.mouseX=-1,this.mouseY=-1,this.mouseButton=0,this.mouseClickX=-1,this.mouseClickY=-1,a.enabled)a.mouseExited()}onmousemove(L){if(this.setMousePosition(L),this.idleCycles=performance.now(),this.isMobile&&this.touching){if(y.isDisplayed())y.notifyTouchMove(this.mouseX,this.mouseY)}if(a.enabled)a.mouseMoved(this.mouseX,this.mouseY)}onfocus(L){if(this.hasFocus=!0,this.redrawScreen=!0,this.refresh(),a.enabled)a.focusGained()}onblur(L){this.hasFocus=!1;for(let N=0;N<128;N++)this.actionKey[N]=0;if(a.enabled)a.focusLost()}ontouchstart(L){if(!this.isMobile)return;this.touching=!0;let N=L.changedTouches[0],$=N.clientX|0,G=N.clientY|0;this.onmousemove(new MouseEvent("mousemove",{clientX:$,clientY:G})),this.sx=this.nx=this.mx=N.screenX|0,this.sy=this.ny=this.my=N.screenY|0,this.time=L.timeStamp,this.startedInViewport=this.insideViewportArea(),this.startedInTabArea=this.insideTabArea()}ontouchend(L){if(!this.isMobile||!this.touching)return;let N=L.changedTouches[0],$=N.clientX|0,G=N.clientY|0;if(this.onmousemove(new MouseEvent("mousemove",{clientX:$,clientY:G})),this.nx=N.screenX|0,this.ny=N.screenY|0,this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowLeft",code:"ArrowLeft"})),this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowUp",code:"ArrowUp"})),this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowRight",code:"ArrowRight"})),this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowDown",code:"ArrowDown"})),this.startedInViewport&&!this.insideViewportArea()){this.touching=!1;return}else if(this.startedInTabArea&&!this.insideTabArea()){this.touching=!1;return}else if(this.insideMobileInputArea()){this.touching=!1;return}let Q=L.timeStamp>=this.time+500,J=Math.abs(this.sx-this.nx)>16||Math.abs(this.sy-this.ny)>16;if(Q&&!J)this.touching=!0,this.onmousedown(new MouseEvent("mousedown",{clientX:$,clientY:G,button:2})),this.onmouseup(new MouseEvent("mouseup",{clientX:$,clientY:G,button:2}))}ontouchmove(L){if(!this.isMobile||!this.touching)return;if(L.touches.length>1)return;L.preventDefault();let N=L.changedTouches[0],$=N.clientX|0,G=N.clientY|0;if(this.onmousemove(new MouseEvent("mousemove",{clientX:$,clientY:G})),this.nx=N.screenX|0,this.ny=N.screenY|0,!y.isWithinCanvasKeyboard(this.mouseX,this.mouseY)){if(this.startedInViewport&&this.getViewportInterfaceId()===-1){if(this.mx-this.nx>0)this.rotate(2);else if(this.mx-this.nx<0)this.rotate(0);if(this.my-this.ny>0)this.rotate(3);else if(this.my-this.ny<0)this.rotate(1)}else if(this.startedInTabArea||this.getViewportInterfaceId()!==-1)this.onmousedown(new MouseEvent("mousedown",{clientX:$,clientY:G,button:1}))}this.mx=this.nx,this.my=this.ny}get isMobile(){if(["Android","webOS","iPhone","iPad","iPod","BlackBerry","Windows Phone"].some((N)=>navigator.userAgent.includes(N)))return!0;if(navigator){if(navigator.maxTouchPoints!==void 0&&navigator.maxTouchPoints>2&&navigator.standalone!==void 0)return!0}return!1}get isAndroid(){return["Android"].some((N)=>navigator.userAgent.includes(N))}get isCapacitor(){return["Capacitor"].some((N)=>navigator.userAgent.includes(N))}insideViewportArea(){return this.ingame&&this.mouseX>=4&&this.mouseX<=516&&this.mouseY>=4&&this.mouseY<=338}insideMobileInputArea(){return this.insideChatInputArea()||this.insideChatPopupArea()||this.insideUsernameArea()||this.inPasswordArea()||this.insideReportInterfaceTextArea()}insideChatInputArea(){return this.ingame&&this.getChatInterfaceId()===-1&&!this.isChatBackInputOpen()&&!this.isShowSocialInput()&&this.mouseX>=17&&this.mouseX<=496&&this.mouseY>=434&&this.mouseY<=460}insideChatPopupArea(){return this.ingame&&(this.isChatBackInputOpen()||this.isShowSocialInput())&&this.mouseX>=17&&this.mouseX<=496&&this.mouseY>=357&&this.mouseY<=453}insideReportInterfaceTextArea(){if(!this.ingame)return!1;let L=this.getViewportInterfaceId(),N=this.getReportAbuseInterfaceId();if(L===-1||N===-1)return!1;if(L!==N)return!1;let $=87,G=119,m=$+348,Q=G+37;return this.mouseX>=$&&this.mouseX<=m&&this.mouseY>=G&&this.mouseY<=Q}insideTabArea(){return this.ingame&&this.mouseX>=553&&this.mouseX<=743&&this.mouseY>=205&&this.mouseY<=466}insideUsernameArea(){return!this.ingame&&this.getTitleScreenState()===2&&this.mouseX>=280&&this.mouseX<=470&&this.mouseY>=233&&this.mouseY<=264}inPasswordArea(){return!this.ingame&&this.getTitleScreenState()===2&&this.mouseX>=280&&this.mouseX<=558&&this.mouseY>=264&&this.mouseY<=284}rotate(L){if(L===0)this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowRight",code:"ArrowRight"})),this.onkeydown(new KeyboardEvent("keydown",{key:"ArrowLeft",code:"ArrowLeft"}));else if(L===1)this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowDown",code:"ArrowDown"})),this.onkeydown(new KeyboardEvent("keydown",{key:"ArrowUp",code:"ArrowUp"}));else if(L===2)this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowLeft",code:"ArrowLeft"})),this.onkeydown(new KeyboardEvent("keydown",{key:"ArrowRight",code:"ArrowRight"}));else if(L===3)this.onkeyup(new KeyboardEvent("keyup",{key:"ArrowUp",code:"ArrowUp"})),this.onkeydown(new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown"}))}isFullScreen(){return document.fullscreenElement!==null}setMousePosition(L){let N=this.width,$=this.height,G=D.getBoundingClientRect(),m={x:L.clientX-G.left,y:L.clientY-G.top},Q=0,J=0;if(this.isFullScreen()){let T=N/$,H=window.innerWidth/window.innerHeight>=T,Z=0,q=0,W=0,M=0;if(H)Z=window.innerHeight*T,q=window.innerHeight,W=(window.innerWidth-Z)/2;else Z=window.innerWidth,q=window.innerWidth/T,M=(window.innerHeight-q)/2;let I=N/Z,U=$/q;Q=(m.x-W)*I|0,J=(m.y-M)*U|0}else{let T=D.width/G.width,E=D.height/G.height;Q=m.x*T|0,J=m.y*E|0}if(Q>=0&&Q<N&&J>=0&&J<$)this.mouseX=Q,this.mouseY=J}}async function u0(L){if(L[0]!==255)L[0]=255;URL.revokeObjectURL(Q0.src),Q0.src=URL.createObjectURL(new Blob([L],{type:"image/jpeg"})),await new Promise((G)=>Q0.onload=()=>G()),M0.clearRect(0,0,J0.width,J0.height);let N=Q0.naturalWidth,$=Q0.naturalHeight;return J0.width=N,J0.height=$,M0.drawImage(Q0,0,0),M0.getImageData(0,0,N,$)}class L0 extends F{pixels;cropRight;cropBottom;cropLeft;cropTop;width;height;constructor(L,N){super();this.pixels=new Int32Array(L*N),this.cropRight=this.width=L,this.cropBottom=this.height=N,this.cropLeft=this.cropTop=0}static async fromJpeg(L,N){let $=L.read(N+".dat");if(!$)throw new Error;let G=await u0($),m=new L0(G.width,G.height),Q=new Uint32Array(G.data.buffer),J=m.pixels;for(let T=0;T<J.length;T++){let E=Q[T];J[T]=(E>>24&255)<<24|(E&255)<<16|(E>>8&255)<<8|E>>16&255}return m}static fromArchive(L,N,$=0){let G=new v(L.read(N+".dat")),m=new v(L.read("index.dat"));m.pos=G.g2();let Q=m.g2(),J=m.g2(),T=m.g1(),E=[],H=T-1;for(let j=0;j<H;j++)if(E[j+1]=m.g3(),E[j+1]===0)E[j+1]=1;for(let j=0;j<$;j++)m.pos+=2,G.pos+=m.g2()*m.g2(),m.pos+=1;if(G.pos>G.length||m.pos>m.length)throw new Error;let Z=m.g1(),q=m.g1(),W=m.g2(),M=m.g2(),I=new L0(W,M);I.cropLeft=Z,I.cropTop=q,I.width=Q,I.height=J;let U=m.g1();if(U===0){let j=I.cropRight*I.cropBottom;for(let _=0;_<j;_++)I.pixels[_]=E[G.g1()]}else if(U===1){let j=I.cropRight;for(let _=0;_<j;_++){let X=I.cropBottom;for(let k=0;k<X;k++)I.pixels[_+k*j]=E[G.g1()]}}return I}bind(){F.bind(this.pixels,this.cropRight,this.cropBottom)}draw(L,N){L|=0,N|=0,L+=this.cropLeft,N+=this.cropTop;let $=L+N*F.width2d,G=0,m=this.cropBottom,Q=this.cropRight,J=F.width2d-Q,T=0;if(N<F.top){let E=F.top-N;m-=E,N=F.top,G+=E*Q,$+=E*F.width2d}if(N+m>F.bottom)m-=N+m-F.bottom;if(L<F.left){let E=F.left-L;Q-=E,L=F.left,G+=E,$+=E,T+=E,J+=E}if(L+Q>F.right){let E=L+Q-F.right;Q-=E,T+=E,J+=E}if(Q>0&&m>0)this.copyImageDraw(Q,m,this.pixels,G,T,F.pixels,$,J)}drawAlpha(L,N,$){N|=0,$|=0,N+=this.cropLeft,$+=this.cropTop;let G=N+$*F.width2d,m=0,Q=this.cropBottom,J=this.cropRight,T=F.width2d-J,E=0;if($<F.top){let H=F.top-$;Q-=H,$=F.top,m+=H*J,G+=H*F.width2d}if($+Q>F.bottom)Q-=$+Q-F.bottom;if(N<F.left){let H=F.left-N;J-=H,N=F.left,m+=H,G+=H,E+=H,T+=H}if(N+J>F.right){let H=N+J-F.right;J-=H,E+=H,T+=H}if(J>0&&Q>0)this.copyPixelsAlpha(J,Q,this.pixels,m,E,F.pixels,G,T,L)}blitOpaque(L,N){L|=0,N|=0,L+=this.cropLeft,N+=this.cropTop;let $=L+N*F.width2d,G=0,m=this.cropBottom,Q=this.cropRight,J=F.width2d-Q,T=0;if(N<F.top){let E=F.top-N;m-=E,N=F.top,G+=E*Q,$+=E*F.width2d}if(N+m>F.bottom)m-=N+m-F.bottom;if(L<F.left){let E=F.left-L;Q-=E,L=F.left,G+=E,$+=E,T+=E,J+=E}if(L+Q>F.right){let E=L+Q-F.right;Q-=E,T+=E,J+=E}if(Q>0&&m>0)this.copyImageBlitOpaque(Q,m,this.pixels,G,T,F.pixels,$,J)}flipHorizontally(){let L=this.pixels,N=this.cropRight,$=this.cropBottom;for(let G=0;G<$;G++){let m=N/2|0;for(let Q=0;Q<m;Q++){let J=Q+G*N,T=N-Q-1+G*N,E=L[J];L[J]=L[T],L[T]=E}}}flipVertically(){let L=this.pixels,N=this.cropRight,$=this.cropBottom;for(let G=0;G<($/2|0);G++)for(let m=0;m<N;m++){let Q=m+G*N,J=m+($-G-1)*N,T=L[Q];L[Q]=L[J],L[J]=T}}translate2d(L,N,$){for(let G=0;G<this.pixels.length;G++){let m=this.pixels[G];if(m!==0){let Q=m>>16&255;if(Q+=L,Q<1)Q=1;else if(Q>255)Q=255;let J=m>>8&255;if(J+=N,J<1)J=1;else if(J>255)J=255;let T=m&255;if(T+=$,T<1)T=1;else if(T>255)T=255;this.pixels[G]=(Q<<16)+(J<<8)+T}}}crop(){let L=new Int32Array(this.width*this.height);for(let N=0;N<this.cropBottom;N++)for(let $=0;$<this.cropRight;$++)L[(this.cropTop+N)*this.width+this.cropLeft+$]=this.pixels[this.cropRight*N+$];this.pixels=L,this.cropRight=this.width,this.cropBottom=this.height,this.cropLeft=0,this.cropTop=0}drawRotated(L,N,$,G,m,Q,J,T){T|=0,L|=0,Q|=0,J|=0;try{let E=-Q/2|0,H=-J/2|0,Z=Math.sin(N)*65536|0,q=Math.cos(N)*65536|0,W=Z*$>>8,M=q*$>>8,I=(G<<16)+(H*W+E*M),U=(m<<16)+(H*M-E*W),j=T+L*F.width2d;for(let _=0;_<J;_++){let X=j,k=I,u=U;for(let b=-Q;b<0;b++){let O=this.pixels[(k>>16)+(u>>16)*this.width];if(O==0)X++;else F.pixels[X++]=O;k+=M,u-=W}I+=W,U+=M,j+=F.width2d}}catch(E){}}drawRotatedMasked(L,N,$,G,m,Q,J,T,E,H){L|=0,N|=0,$|=0,G|=0;try{let Z=-$/2|0,q=-G/2|0,W=Math.sin(E/326.11)*65536|0,M=Math.cos(E/326.11)*65536|0,I=W*H>>8,U=M*H>>8,j=(J<<16)+q*I+Z*U,_=(T<<16)+(q*U-Z*I),X=L+N*F.width2d;for(let k=0;k<G;k++){let u=m[k],b=X+u,O=j+U*u,n=_-I*u;for(let V=-Q[k];V<0;V++)F.pixels[b++]=this.pixels[(O>>16)+(n>>16)*this.cropRight],O+=U,n-=I;j+=I,_+=U,X+=F.width2d}}catch(Z){}}drawMasked(L,N,$){L|=0,N|=0,L+=this.cropLeft,N+=this.cropTop;let G=L+N*F.width2d,m=0,Q=this.cropBottom,J=this.cropRight,T=F.width2d-J,E=0;if(N<F.top){let H=F.top-N;Q-=H,N=F.top,m+=H*J,G+=H*F.width2d}if(N+Q>F.bottom)Q-=N+Q-F.bottom;if(L<F.left){let H=F.left-L;J-=H,L=F.left,m+=H,G+=H,E+=H,T+=H}if(L+J>F.right){let H=L+J-F.right;J-=H,E+=H,T+=H}if(J>0&&Q>0)this.copyPixelsMasked(J,Q,this.pixels,E,m,F.pixels,G,T,$.pixels)}scale(L,N,$,G,m,Q,J,T,E,H,Z){try{let q=G;for(let W=-N;W<0;W++){let M=(m>>16)*E;for(let I=-L;I<0;I++){let U=$[(G>>16)+M];if(U===0)T++;else Q[T++]=U;G+=H}m+=Z,G=q,T+=J}}catch(q){}}copyImageBlitOpaque(L,N,$,G,m,Q,J,T){let E=-(L>>2);L=-(L&3);for(let H=-N;H<0;H++){for(let Z=E;Z<0;Z++)Q[J++]=$[G++],Q[J++]=$[G++],Q[J++]=$[G++],Q[J++]=$[G++];for(let Z=L;Z<0;Z++)Q[J++]=$[G++];J+=T,G+=m}}copyPixelsAlpha(L,N,$,G,m,Q,J,T,E){let H=256-E;for(let Z=-N;Z<0;Z++){for(let q=-L;q<0;q++){let W=$[G++];if(W===0)J++;else{let M=Q[J];Q[J++]=((W&16711935)*E+(M&16711935)*H&4278255360)+((W&65280)*E+(M&65280)*H&16711680)>>8}}J+=T,G+=m}}copyImageDraw(L,N,$,G,m,Q,J,T){let E=-(L>>2);L=-(L&3);for(let H=-N;H<0;H++){for(let Z=E;Z<0;Z++){let q=$[G++];if(q===0)J++;else Q[J++]=q;if(q=$[G++],q===0)J++;else Q[J++]=q;if(q=$[G++],q===0)J++;else Q[J++]=q;if(q=$[G++],q===0)J++;else Q[J++]=q}for(let Z=L;Z<0;Z++){let q=$[G++];if(q===0)J++;else Q[J++]=q}J+=T,G+=m}}copyPixelsMasked(L,N,$,G,m,Q,J,T,E){let H=-(L>>2);L=-(L&3);for(let Z=-N;Z<0;Z++){for(let q=H;q<0;q++){let W=$[m++];if(W!==0&&E[J]===0)Q[J++]=W;else J++;if(W=$[m++],W!==0&&E[J]===0)Q[J++]=W;else J++;if(W=$[m++],W!==0&&E[J]===0)Q[J++]=W;else J++;if(W=$[m++],W!==0&&E[J]===0)Q[J++]=W;else J++}for(let q=L;q<0;q++){let W=$[m++];if(W!==0&&E[J]===0)Q[J++]=W;else J++}J+=T,m+=G}}}class _0{seed;constructor(L){this.seed=(L^0x5deece66dn)&(1n<<48n)-1n}setSeed(L){this.seed=(L^0x5deece66dn)&(1n<<48n)-1n}nextInt(){return this.next(32)}next(L){return this.seed=this.seed*0x5deece66dn+0xbn&(1n<<48n)-1n,Number(this.seed)>>>48-L}}class o extends N0{static CHARSET=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!"£$%^&*()-_=+[{]};:'@#~,<.>/?\\| `;static CHARCODESET=[];charMask=[];charMaskWidth=new Int32Array(94);charMaskHeight=new Int32Array(94);charOffsetX=new Int32Array(94);charOffsetY=new Int32Array(94);charAdvance=new Int32Array(95);drawWidth=new Int32Array(256);random=new _0(BigInt(Date.now()));height2d=0;static{let L=navigator.userAgent.includes("Capacitor");for(let N=0;N<256;N++){let $=o.CHARSET.indexOf(String.fromCharCode(N));if(L){if($>=63)$--}if($===-1)$=74;o.CHARCODESET[N]=$}}static fromArchive(L,N){let $=new v(L.read(N+".dat")),G=new v(L.read("index.dat"));G.pos=$.g2()+4;let m=G.g1();if(m>0)G.pos+=(m-1)*3;let Q=new o;for(let J=0;J<94;J++){Q.charOffsetX[J]=G.g1(),Q.charOffsetY[J]=G.g1();let T=Q.charMaskWidth[J]=G.g2(),E=Q.charMaskHeight[J]=G.g2(),H=G.g1(),Z=T*E;if(Q.charMask[J]=new Int8Array(Z),H===0)for(let q=0;q<T*E;q++)Q.charMask[J][q]=$.g1b();else if(H===1)for(let q=0;q<T;q++)for(let W=0;W<E;W++)Q.charMask[J][q+W*T]=$.g1b();if(E>Q.height2d)Q.height2d=E;Q.charOffsetX[J]=1,Q.charAdvance[J]=T+2;{let q=0;for(let W=E/7|0;W<E;W++)q+=Q.charMask[J][W*T];if(q<=(E/7|0))Q.charAdvance[J]--,Q.charOffsetX[J]=0}{let q=0;for(let W=E/7|0;W<E;W++)q+=Q.charMask[J][T+W*T-1];if(q<=(E/7|0))Q.charAdvance[J]--}}Q.charAdvance[94]=Q.charAdvance[8];for(let J=0;J<256;J++)Q.drawWidth[J]=Q.charAdvance[o.CHARCODESET[J]];return Q}drawString(L,N,$,G){if(!$)return;L|=0,N|=0;let m=$.length;N-=this.height2d;for(let Q=0;Q<m;Q++){let J=o.CHARCODESET[$.charCodeAt(Q)];if(J!==94)this.drawChar(this.charMask[J],L+this.charOffsetX[J],N+this.charOffsetY[J],this.charMaskWidth[J],this.charMaskHeight[J],G);L+=this.charAdvance[J]}}drawStringTaggable(L,N,$,G,m){L|=0,N|=0;let Q=$.length;N-=this.height2d;for(let J=0;J<Q;J++)if($.charAt(J)==="@"&&J+4<Q&&$.charAt(J+4)==="@")G=this.evaluateTag($.substring(J+1,J+4)),J+=4;else{let T=o.CHARCODESET[$.charCodeAt(J)];if(T!==94){if(m)this.drawChar(this.charMask[T],L+this.charOffsetX[T]+1,N+this.charOffsetY[T]+1,this.charMaskWidth[T],this.charMaskHeight[T],0);this.drawChar(this.charMask[T],L+this.charOffsetX[T],N+this.charOffsetY[T],this.charMaskWidth[T],this.charMaskHeight[T],G)}L+=this.charAdvance[T]}}stringWidth(L){if(!L)return 0;let N=L.length,$=0;for(let G=0;G<N;G++)if(L.charAt(G)==="@"&&G+4<N&&L.charAt(G+4)==="@")G+=4;else $+=this.drawWidth[L.charCodeAt(G)];return $}drawStringTaggableCenter(L,N,$,G,m){L|=0,N|=0,this.drawStringTaggable(L-(this.stringWidth($)/2|0),N,$,G,m)}drawStringCenter(L,N,$,G){if(!$)return;L|=0,N|=0,this.drawString(L-(this.stringWidth($)/2|0),N,$,G)}drawStringTooltip(L,N,$,G,m,Q){L|=0,N|=0,this.random.setSeed(BigInt(Q));let J=(this.random.nextInt()&31)+192,T=N-this.height2d;for(let E=0;E<$.length;E++)if($.charAt(E)==="@"&&E+4<$.length&&$.charAt(E+4)==="@")G=this.evaluateTag($.substring(E+1,E+4)),E+=4;else{let H=o.CHARCODESET[$.charCodeAt(E)];if(H!==94){if(m)this.drawCharAlpha(L+this.charOffsetX[H]+1,T+this.charOffsetY[H]+1,this.charMaskWidth[H],this.charMaskHeight[H],0,192,this.charMask[H]);this.drawCharAlpha(L+this.charOffsetX[H],T+this.charOffsetY[H],this.charMaskWidth[H],this.charMaskHeight[H],G,J,this.charMask[H])}if(L+=this.charAdvance[H],(this.random.nextInt()&3)===0)L++}}drawStringRight(L,N,$,G,m=!0){if(L|=0,N|=0,m)this.drawString(L-this.stringWidth($)+1,N+1,$,0);this.drawString(L-this.stringWidth($),N,$,G)}drawCenteredWave(L,N,$,G,m){if(!$)return;L|=0,N|=0,L-=this.stringWidth($)/2|0;let Q=N-this.height2d;for(let J=0;J<$.length;J++){let T=o.CHARCODESET[$.charCodeAt(J)];if(T!=94)this.drawChar(this.charMask[T],L+this.charOffsetX[T],Q+this.charOffsetY[T]+(Math.sin(J/2+m/5)*5|0),this.charMaskWidth[T],this.charMaskHeight[T],G);L+=this.charAdvance[T]}}drawChar(L,N,$,G,m,Q){N|=0,$|=0,G|=0,m|=0;let J=N+$*F.width2d,T=F.width2d-G,E=0,H=0;if($<F.top){let Z=F.top-$;m-=Z,$=F.top,H+=Z*G,J+=Z*F.width2d}if($+m>=F.bottom)m-=$+m+1-F.bottom;if(N<F.left){let Z=F.left-N;G-=Z,N=F.left,H+=Z,J+=Z,E+=Z,T+=Z}if(N+G>=F.right){let Z=N+G+1-F.right;G-=Z,E+=Z,T+=Z}if(G>0&&m>0)this.drawMask(G,m,L,H,E,F.pixels,J,T,Q)}drawCharAlpha(L,N,$,G,m,Q,J){L|=0,N|=0,$|=0,G|=0;let T=L+N*F.width2d,E=F.width2d-$,H=0,Z=0;if(N<F.top){let q=F.top-N;G-=q,N=F.top,Z+=q*$,T+=q*F.width2d}if(N+G>=F.bottom)G-=N+G+1-F.bottom;if(L<F.left){let q=F.left-L;$-=q,L=F.left,Z+=q,T+=q,H+=q,E+=q}if(L+$>=F.right){let q=L+$+1-F.right;$-=q,H+=q,E+=q}if($>0&&G>0)this.drawMaskAlpha($,G,F.pixels,T,E,J,Z,H,m,Q)}drawMask(L,N,$,G,m,Q,J,T,E){L|=0,N|=0;let H=-(L>>2);L=-(L&3);for(let Z=-N;Z<0;Z++){for(let q=H;q<0;q++){if($[G++]===0)J++;else Q[J++]=E;if($[G++]===0)J++;else Q[J++]=E;if($[G++]===0)J++;else Q[J++]=E;if($[G++]===0)J++;else Q[J++]=E}for(let q=L;q<0;q++)if($[G++]===0)J++;else Q[J++]=E;J+=T,G+=m}}drawMaskAlpha(L,N,$,G,m,Q,J,T,E,H){L|=0,N|=0;let Z=((E&16711935)*H&4278255360)+((E&65280)*H&16711680)>>8,q=256-H;for(let W=-N;W<0;W++){for(let M=-L;M<0;M++)if(Q[J++]===0)G++;else{let I=$[G];$[G++]=(((I&16711935)*q&4278255360)+((I&65280)*q&16711680)>>8)+Z}G+=m,J+=T}}evaluateTag(L){if(L==="red")return 16711680;else if(L==="gre")return 65280;else if(L==="blu")return 255;else if(L==="yel")return 16776960;else if(L==="cya")return 65535;else if(L==="mag")return 16711935;else if(L==="whi")return 16777215;else if(L==="bla")return 0;else if(L==="lre")return 16748608;else if(L==="dre")return 8388608;else if(L==="dbl")return 128;else if(L==="or1")return 16756736;else if(L==="or2")return 16740352;else if(L==="or3")return 16723968;else if(L==="gr1")return 12648192;else if(L==="gr2")return 8453888;else if(L==="gr3")return 4259584;else return 0}split(L,N){if(L.length===0)return[L];let $=[];while(L.length>0){if(this.stringWidth(L)<=N&&L.indexOf("|")===-1){$.push(L);break}let m=L.length;for(let Q=0;Q<L.length;Q++)if(L[Q]===" "){if(this.stringWidth(L.substring(0,Q))>N)break;m=Q}else if(L[Q]==="|"){m=Q;break}$.push(L.substring(0,m)),L=L.substring(m+1)}return $}}class q0{db;constructor(L){L.onerror=this.onerror,L.onclose=this.onclose,this.db=L}static async openDatabase(){return await new Promise((L,N)=>{let $=indexedDB.open("lostcity",1);$.onsuccess=(G)=>{let m=G.target;L(m.result)},$.onupgradeneeded=(G)=>{G.target.result.createObjectStore("cache")},$.onerror=(G)=>{let m=G.target;N(m.result)}})}async read(L,N){return await new Promise(($)=>{let Q=this.db.transaction("cache","readonly").objectStore("cache").get(`${L}.${N}`);Q.onsuccess=()=>{if(Q.result)$(new Uint8Array(Q.result));else $(void 0)},Q.onerror=()=>{$(void 0)}})}async cacheload(L){return await new Promise((N)=>{let m=this.db.transaction("cache","readonly").objectStore("cache").get(L);m.onsuccess=()=>{if(m.result)N(new Uint8Array(m.result));else N(void 0)},m.onerror=()=>{N(void 0)}})}async write(L,N,$){if($===null)return;return await new Promise((G,m)=>{let T=this.db.transaction("cache","readwrite").objectStore("cache").put($,`${L}.${N}`);T.onsuccess=()=>{G()},T.onerror=()=>{G()}})}async cachesave(L,N){if(N===null)return;return await new Promise(($,G)=>{let J=this.db.transaction("cache","readwrite").objectStore("cache").put(N,L);J.onsuccess=()=>{$()},J.onerror=()=>{$()}})}onclose=(L)=>{};onerror=(L)=>{}}import{BZip2 as v0}from"./deps.js";class F0{static genHash(L){let N=0;L=L.toUpperCase();for(let $=0;$<L.length;$++)N=N*61+L.charCodeAt($)-32|0;return N}jagSrc;compressedWhole;fileCount;fileHash;fileUnpackedSize;filePackedSize;fileOffset;fileUnpacked=[];constructor(L){let N=new v(new Uint8Array(L)),$=N.g3(),G=N.g3();if($===G)this.jagSrc=L,this.compressedWhole=!1;else this.jagSrc=v0.decompress(L.subarray(6),$,!0),N=new v(new Uint8Array(this.jagSrc)),this.compressedWhole=!0;this.fileCount=N.g2(),this.fileHash=[],this.fileUnpackedSize=[],this.filePackedSize=[],this.fileOffset=[];let m=N.pos+this.fileCount*10;for(let Q=0;Q<this.fileCount;Q++)this.fileHash.push(N.g4()),this.fileUnpackedSize.push(N.g3()),this.filePackedSize.push(N.g3()),this.fileOffset.push(m),m+=this.filePackedSize[Q]}read(L){let N=F0.genHash(L),$=this.fileHash.indexOf(N);if($===-1)return null;return this.readIndex($)}readIndex(L){if(L<0||L>=this.fileCount)return null;if(this.fileUnpacked[L])return this.fileUnpacked[L];let N=this.fileOffset[L],$=N+this.filePackedSize[L],G=new Uint8Array(this.jagSrc.subarray(N,N+$));if(this.compressedWhole)return this.fileUnpacked[L]=G,G;else{let m=v0.decompress(G,this.fileUnpackedSize[L],!0);return this.fileUnpacked[L]=m,m}}}class x extends j0{static shouldDrawBorders=!1;static shouldDrawLabels=!0;static shouldDrawNpcs=!1;static shouldDrawItems=!1;startX=3200;startZ=3200;sizeX=1280;sizeZ=1344;originX=2240;originZ=2752;db=null;maxLabelCount=1000;labelCount=0;labelText=[];labelX=[];labelY=[];labelFont=[];floorcolUnderlay=[0];floorcolOverlay=[0];underlayTiles=[];overlayTiles=[];overlayInfo=[];locWalls=[];locMapscenes=[];locMapfunction=[];objTiles=[];npcTiles=[];imageMapscene=[];imageMapfunction=[];imageMapdot0=null;imageMapdot1=null;imageMapdot2=null;imageMapdot3=null;b12=null;floormapColors=[];redraw=!0;redrawTimer=0;lastMouseClickX=-1;lastMouseClickY=-1;lastOffsetX=-1;lastOffsetZ=-1;shouldClearEmptyTiles=!1;keyX=5;keyY=13;keyWidth=140;keyHeight=470;showKey=!1;keyPage=0;lastKeyPage=0;currentKeyHover=-1;lastKeyHover=0;currentKey=0;flashTimer=0;visibleMapFunctionsX=new Int32Array(2000);visibleMapFunctionsY=new Int32Array(2000);visibleMapFunctions=new Int32Array(2000);activeMapFunctionX=new Int32Array(2000);activeMapFunctionZ=new Int32Array(2000);activeMapFunctions=new Int32Array(2000);activeMapFunctionCount=0;imageOverview=null;imageOverviewHeight=200;imageOverviewWidth=this.imageOverviewHeight*this.sizeX/this.sizeZ|0;overviewX=635-this.imageOverviewWidth-5;overviewY=503-this.imageOverviewHeight-20;showOverview=!1;colorInactiveBorderTL=8943445;colorInactive=7824964;colorInactiveBorderBR=6706483;colorActiveBorderTL=11141120;colorActive=10027008;colorActiveBorderBR=8912896;zoom=4;targetZoom=4;offsetX=this.startX-this.originX;offsetZ=this.originZ+this.sizeZ-this.startZ;activeTileX=-1;activeTileZ=-1;keyNames=["General Store","Sword Shop","Magic Shop","Axe Shop","Helmet Shop","Bank","Quest Start","Amulet Shop","Mining Site","Furnace","Anvil","Combat Training","Dungeon","Staff Shop","Platebody Shop","Platelegs Shop","Scimitar Shop","Archery Shop","Shield Shop","Altar","Herbalist","Jewelery","Gem Shop","Crafting Shop","Candle Shop","Fishing Shop","Fishing Spot","Clothes Shop","Apothecary","Silk Trader","Kebab Seller","Pub/Bar","Mace Shop","Tannery","Rare Trees","Spinning Wheel","Food Shop","Cookery Shop","???","Water Source","Cooking Range","Skirt Shop","Potters Wheel","Windmill","Mining Shop","Chainmail Shop","Silver Shop","Fur Trader","Spice Shop"];constructor(){super();this.run()}async load(){this.keyHeight=this.height-this.keyY-20,this.overviewX=this.width-this.imageOverviewWidth-5,this.overviewY=this.height-this.imageOverviewHeight-20,this.db=new q0(await q0.openDatabase());let L=await this.loadWorldmap();await this.drawProgress(100,"Please wait... Rendering Map");let N=new v(L.read("labels.dat"));this.labelCount=N.g2();for(let H=0;H<this.labelCount;H++)this.labelText[H]=N.gjstr(),this.labelX[H]=N.g2(),this.labelY[H]=N.g2(),this.labelFont[H]=N.g1();let $=new v(L.read("floorcol.dat")),G=$.g2();for(let H=0;H<G;H++)this.floorcolUnderlay[H+1]=$.g4(),this.floorcolOverlay[H+1]=$.g4();let m=new v(L.read("underlay.dat"));this.underlayTiles=new t(this.sizeX,this.sizeZ,0),this.readUnderlayData(m);let Q=new v(L.read("overlay.dat"));this.overlayTiles=new t(this.sizeX,this.sizeZ,0),this.overlayInfo=new t(this.sizeX,this.sizeZ,0),this.readOverlayData(Q);let J=new v(L.read("loc.dat"));this.locWalls=new t(this.sizeX,this.sizeZ,0),this.locMapscenes=new t(this.sizeX,this.sizeZ,0),this.locMapfunction=new t(this.sizeX,this.sizeZ,0),this.readLocData(J);let T=new v(L.read("obj.dat"));this.objTiles=new t(this.sizeX,this.sizeZ,!1),this.readObjData(T);let E=new v(L.read("npc.dat"));this.npcTiles=new t(this.sizeX,this.sizeZ,!1),this.readNpcData(E);try{for(let H=0;H<50;H++)this.imageMapscene[H]=$0.fromArchive(L,"mapscene",H)}catch(H){}try{for(let H=0;H<50;H++)this.imageMapfunction[H]=L0.fromArchive(L,"mapfunction",H)}catch(H){}if(this.imageMapdot0=L0.fromArchive(L,"mapdots",0),this.imageMapdot1=L0.fromArchive(L,"mapdots",1),this.imageMapdot2=L0.fromArchive(L,"mapdots",2),this.imageMapdot3=L0.fromArchive(L,"mapdots",3),this.b12=o.fromArchive(L,"b12"),this.floormapColors=new t(this.sizeX,this.sizeZ,0),this.averageUnderlayColors(),this.shouldClearEmptyTiles)this.clearEmptyTiles();if(this.imageOverview=new L0(this.imageOverviewWidth,this.imageOverviewHeight),this.imageOverview.bind(),this.drawMap(0,0,this.sizeX,this.sizeZ,0,0,this.imageOverviewWidth,this.imageOverviewHeight),F.drawRect(0,0,this.imageOverviewWidth,this.imageOverviewHeight,0),F.drawRect(1,1,this.imageOverviewWidth-2,this.imageOverviewHeight-2,this.colorInactiveBorderTL),this.drawArea)this.drawArea.bind()}async draw(){if(this.redraw){this.redraw=!1,this.redrawTimer=0,F.clear();let L=this.offsetX-(this.width/this.zoom|0),N=this.offsetZ-(this.height/this.zoom|0),$=this.offsetX+(this.width/this.zoom|0),G=this.offsetZ+(this.height/this.zoom|0);if(this.drawMap(L,N,$,G,0,0,this.width,this.height),this.showOverview){if(this.imageOverview?.blitOpaque(this.overviewX,this.overviewY),F.fillRectAlpha(this.overviewX+this.imageOverviewWidth*L/this.sizeX|0,this.overviewY+this.imageOverviewHeight*N/this.sizeZ|0,($-L)*this.imageOverviewWidth/this.sizeX|0,(G-N)*this.imageOverviewHeight/this.sizeZ|0,16711680,128),F.drawRect(this.overviewX+this.imageOverviewWidth*L/this.sizeX|0,this.overviewY+this.imageOverviewHeight*N/this.sizeZ|0,($-L)*this.imageOverviewWidth/this.sizeX|0,(G-N)*this.imageOverviewHeight/this.sizeZ|0,16711680),this.flashTimer>0&&this.flashTimer%10<5){for(let Q=0;Q<this.activeMapFunctionCount;Q++)if(this.activeMapFunctions[Q]==this.currentKey){let J=this.overviewX+this.imageOverviewWidth*this.activeMapFunctionX[Q]/this.sizeX|0,T=this.overviewY+this.imageOverviewHeight*this.activeMapFunctionZ[Q]/this.sizeZ|0;F.fillCircle(J,T,2,16776960,256)}}}if(this.showKey){this.drawString(this.keyX,this.keyY,this.keyWidth,18,10066329,7829367,5592405,"Prev page"),this.drawString(this.keyX,this.keyY+18,this.keyWidth,this.keyHeight-36,10066329,7829367,5592405,""),this.drawString(this.keyX,this.keyY+this.keyHeight-18,this.keyWidth,18,10066329,7829367,5592405,"Next page");let Q=(this.keyHeight-20)/18,J=this.keyY+18+3;for(let T=0;T<Q;T++){if(T+this.lastKeyPage<this.imageMapfunction.length&&T+this.lastKeyPage<this.keyNames.length){if(this.keyNames[T+this.lastKeyPage]==="???")continue;this.imageMapfunction[T+this.lastKeyPage].draw(this.keyX+3,J),this.b12?.drawString(this.keyX+21,J+14,this.keyNames[T+this.lastKeyPage],0);let E=16777215;if(this.currentKeyHover==T+this.lastKeyPage)E=12298922;if(this.flashTimer>0&&this.flashTimer%10<5&&this.currentKey==T+this.lastKeyPage)E=16776960;this.b12?.drawString(this.keyX+20,J+13,this.keyNames[T+this.lastKeyPage],E)}J+=17}}this.drawString(this.overviewX,this.overviewY+this.imageOverviewHeight,this.imageOverviewWidth,18,this.colorInactiveBorderTL,this.colorInactive,this.colorInactiveBorderBR,"Overview"),this.drawString(this.keyX,this.keyY+this.keyHeight,this.keyWidth,18,this.colorInactiveBorderTL,this.colorInactive,this.colorInactiveBorderBR,"Key");let m=this.height-this.keyY-20+1;if(this.targetZoom==3)this.drawString(170,m,50,30,this.colorActiveBorderTL,this.colorActive,this.colorActiveBorderBR,"37%");else this.drawString(170,m,50,30,this.colorInactiveBorderTL,this.colorInactive,this.colorInactiveBorderBR,"37%");if(this.targetZoom==4)this.drawString(230,m,50,30,this.colorActiveBorderTL,this.colorActive,this.colorActiveBorderBR,"50%");else this.drawString(230,m,50,30,this.colorInactiveBorderTL,this.colorInactive,this.colorInactiveBorderBR,"50%");if(this.targetZoom==6)this.drawString(290,m,50,30,this.colorActiveBorderTL,this.colorActive,this.colorActiveBorderBR,"75%");else this.drawString(290,m,50,30,this.colorInactiveBorderTL,this.colorInactive,this.colorInactiveBorderBR,"75%");if(this.targetZoom==8)this.drawString(350,m,50,30,this.colorActiveBorderTL,this.colorActive,this.colorActiveBorderBR,"100%");else this.drawString(350,m,50,30,this.colorInactiveBorderTL,this.colorInactive,this.colorInactiveBorderBR,"100%")}if(this.redrawTimer--,this.redrawTimer<=0)this.drawArea?.draw(0,0),this.redrawTimer=50}async refresh(){this.redrawTimer=0}async update(){if(this.actionKey[1]==1)this.offsetX=this.offsetX-16/this.zoom|0,this.redraw=!0;if(this.actionKey[2]==1)this.offsetX=this.offsetX+16/this.zoom|0,this.redraw=!0;if(this.actionKey[3]==1)this.offsetZ=this.offsetZ-16/this.zoom|0,this.redraw=!0;if(this.actionKey[4]==1)this.offsetZ=this.offsetZ+16/this.zoom|0,this.redraw=!0;let L=1;do{if(L=this.pollKey(),L===-1)break;if(L==49)this.targetZoom=3,this.redraw=!0;else if(L==50)this.targetZoom=4,this.redraw=!0;else if(L==51)this.targetZoom=6,this.redraw=!0;else if(L==52)this.targetZoom=8,this.redraw=!0;else if(L==107||L==75)this.showKey=!this.showKey,this.redraw=!0;else if(L==111||L==79)this.showOverview=!this.showOverview,this.redraw=!0;else if(L==101||L==69);else if(L==110||L==78)x.shouldDrawNpcs=!x.shouldDrawNpcs,this.redraw=!0;else if(L==105||L==73)x.shouldDrawItems=!x.shouldDrawItems,this.redraw=!0;else if(L==108||L==76)x.shouldDrawLabels=!x.shouldDrawLabels,this.redraw=!0;else if(L==98||L==66)x.shouldDrawBorders=!x.shouldDrawBorders,this.redraw=!0}while(L>0);if(this.mouseClickButton==1){this.lastMouseClickX=this.mouseClickX,this.lastMouseClickY=this.mouseClickY,this.lastOffsetX=this.offsetX,this.lastOffsetZ=this.offsetZ;let Q=this.height-this.keyY-20+1;if(this.mouseClickX>170&&this.mouseClickX<220&&this.mouseClickY>Q)this.targetZoom=3,this.lastMouseClickX=-1;else if(this.mouseClickX>230&&this.mouseClickX<280&&this.mouseClickY>Q)this.targetZoom=4,this.lastMouseClickX=-1;else if(this.mouseClickX>290&&this.mouseClickX<340&&this.mouseClickY>Q)this.targetZoom=6,this.lastMouseClickX=-1;else if(this.mouseClickX>350&&this.mouseClickX<400&&this.mouseClickY>Q)this.targetZoom=8,this.lastMouseClickX=-1;else if(this.mouseClickX>this.keyX&&this.mouseClickY>this.keyY+this.keyHeight&&this.mouseClickX<this.keyX+this.keyWidth)this.showKey=!this.showKey,this.lastMouseClickX=-1;else if(this.mouseClickX>this.overviewX&&this.mouseClickY>this.overviewY+this.imageOverviewHeight&&this.mouseClickX<this.overviewX+this.imageOverviewWidth)this.showOverview=!this.showOverview,this.lastMouseClickX=-1;if(this.showKey){if(this.mouseClickX>this.keyX&&this.mouseClickY>this.keyY&&this.mouseClickX<this.keyX+this.keyWidth&&this.mouseClickY<this.keyY+this.keyHeight)this.lastMouseClickX=-1;if(this.mouseClickX>this.keyX&&this.mouseClickY>this.keyY&&this.mouseClickX<this.keyX+this.keyWidth&&this.mouseClickY<this.keyY+18)this.keyPage=0;else if(this.mouseClickX>this.keyX&&this.mouseClickY>this.keyY+this.keyHeight-18&&this.mouseClickX<this.keyX+this.keyWidth&&this.mouseClickY<this.keyY+this.keyHeight)this.keyPage=25}this.redraw=!0}if(this.showKey){if(this.currentKeyHover=-1,this.mouseX>this.keyX&&this.mouseX<this.keyX+this.keyWidth){let Q=(this.keyHeight-20)/18,J=this.keyY+21+5;for(let T=0;T<Q;T++)if(T+this.lastKeyPage<this.keyNames.length&&this.keyNames[T+this.lastKeyPage]!=="???"){if(this.mouseY>=J&&this.mouseY<J+17){if(this.currentKeyHover=T+this.lastKeyPage,this.mouseClickButton==1)this.currentKey=T+this.lastKeyPage,this.flashTimer=50}J+=17}}if(this.currentKeyHover!=this.lastKeyHover)this.lastKeyHover=this.currentKeyHover,this.redraw=!0}if((this.mouseButton==1||this.mouseClickButton==1)&&this.showOverview){let Q=this.mouseClickX,J=this.mouseClickY;if(this.mouseButton==1)Q=this.mouseX,J=this.mouseY;if(Q>this.overviewX&&J>this.overviewY&&Q<this.overviewX+this.imageOverviewWidth&&J<this.overviewY+this.imageOverviewHeight)this.offsetX=(Q-this.overviewX)*this.sizeX/this.imageOverviewWidth|0,this.offsetZ=(J-this.overviewY)*this.sizeZ/this.imageOverviewHeight|0,this.lastMouseClickX=-1,this.redraw=!0}if(this.mouseButton==1&&this.lastMouseClickX!=-1)this.offsetX=this.lastOffsetX+((this.lastMouseClickX-this.mouseX)*2/this.targetZoom|0),this.offsetZ=this.lastOffsetZ+((this.lastMouseClickY-this.mouseY)*2/this.targetZoom|0),this.redraw=!0;if(this.zoom<this.targetZoom){if(this.redraw=!0,this.zoom+=this.zoom/30,this.zoom>this.targetZoom)this.zoom=this.targetZoom}if(this.zoom>this.targetZoom){if(this.redraw=!0,this.zoom-=this.zoom/30,this.zoom<this.targetZoom)this.zoom=this.targetZoom}if(this.lastKeyPage<this.keyPage)this.redraw=!0,this.lastKeyPage++;if(this.lastKeyPage>this.keyPage)this.redraw=!0,this.lastKeyPage--;if(this.flashTimer>0)this.redraw=!0,this.flashTimer--;let N=this.offsetX-(this.width/this.zoom|0),$=this.offsetZ-(this.height/this.zoom|0),G=this.offsetX+(this.width/this.zoom|0),m=this.offsetZ+(this.height/this.zoom|0);if(N<48)this.offsetX=(this.width/this.zoom|0)+48;if($<48)this.offsetZ=(this.height/this.zoom|0)+48;if(G>this.sizeX-48)this.offsetX=this.sizeX-48-(this.width/this.zoom|0);if(m>this.sizeZ-48)this.offsetZ=this.sizeZ-48-(this.height/this.zoom|0)}async loadWorldmap(){let L=await this.db?.cacheload("worldmap.dat");if(L)return new F0(L);let N=5;while(!L){await this.drawProgress(0,"Requesting map");try{L=await k0("/worldmap.jag")}catch($){L=void 0;for(let G=N;G>0;G--)await this.drawProgress(0,`Error loading - Will retry in ${G} secs.`),await E0(1000);if(N*=2,N>60)N=60}}return await this.db?.cachesave("worldmap.dat",L),new F0(L)}drawString(L,N,$,G,m,Q,J,T){L=Math.trunc(L),N=Math.trunc(N),$=Math.trunc($),G=Math.trunc(G),F.drawRect(L,N,$,G,0);let E=L+1,H=N+1,Z=$-2,q=G-2;F.fillRect2d(E,H,Z,q,Q),F.drawHorizontalLine(E,H,m,Z),F.drawVerticalLine(E,H,m,q),F.drawHorizontalLine(E,H+q-1,J,Z),F.drawVerticalLine(E+Z-1,H,J,q),this.b12?.drawStringCenter(E+Z/2+1,H+q/2+1+4,T,0),this.b12?.drawStringCenter(E+Z/2,H+q/2+4,T,16777215)}clearEmptyTiles(){for(let L=0;L<this.sizeX;L++)for(let N=0;N<this.sizeZ;N++)if(this.underlayTiles[L][N]==0&&this.overlayTiles[L][N]==0)this.floormapColors[L][N]=0}averageUnderlayColors(){let L=this.sizeX,N=this.sizeZ,$=new G0(N,0);for(let G=5;G<L-5;G++){for(let m=0;m<N;m++)$[m]+=this.floorcolUnderlay[this.underlayTiles[G+5][m]]-this.floorcolUnderlay[this.underlayTiles[G-5][m]];if(G>10&&G<L-10){let m=0,Q=0,J=0;for(let T=5;T<N-5;T++){let E=$[T+5],H=$[T-5];if(m+=(E>>20)-(H>>20),Q+=(E>>10&1023)-(H>>10&1023),J+=(E&1023)-(H&1023),J>0)this.floormapColors[G][T]=this.convertHsl(m/8533,Q/8533,J/8533)}}}}readUnderlayData(L){while(L.available>0){let N=L.g1()*64-this.originX,$=L.g1()*64-this.originZ;if(N>0&&$>0&&N+64<this.sizeX&&$+64<this.sizeZ)for(let G=0;G<64;G++){let m=this.sizeZ-$-1;for(let Q=-64;Q<0;Q++)this.underlayTiles[N+G][m--]=L.g1()}else L.pos+=4096}}readOverlayData(L){while(L.available>0){let N=L.g1()*64-this.originX,$=L.g1()*64-this.originZ;if(N>0&&$>0&&N+64<this.sizeX&&$+64<this.sizeZ)for(let G=0;G<64;G++){let m=this.sizeZ-$-1;for(let Q=-64;Q<0;Q++){let J=L.g1();if(J===0)this.overlayTiles[G+N][m--]=0;else this.overlayInfo[G+N][m]=L.g1(),this.overlayTiles[G+N][m--]=this.floorcolOverlay[J]}}else for(let G=-4096;G<0;G++)if(L.g1()!=0)L.g1()}}readLocData(L){while(L.available>0){let N=L.g1()*64-this.originX,$=L.g1()*64-this.originZ;if(N>0&&$>0&&N+64<this.sizeX&&$+64<this.sizeZ)for(let G=0;G<64;G++){let m=this.sizeZ-$-1;for(let Q=-64;Q<0;Q++)while(!0){let J=L.g1();if(J===0){m--;break}if(J<29)this.locWalls[G+N][m]=J;else if(J<160)this.locMapscenes[G+N][m]=J-28;else this.locMapfunction[G+N][m]=J-159,this.activeMapFunctions[this.activeMapFunctionCount]=J-160,this.activeMapFunctionX[this.activeMapFunctionCount]=G+N,this.activeMapFunctionZ[this.activeMapFunctionCount]=m,this.activeMapFunctionCount++}}else for(let G=0;G<64;G++){let m=0;for(let Q=-64;Q<0;Q++)do m=L.g1();while(m!=0)}}}readObjData(L){while(L.available>0){let N=L.g1()*64-this.originX,$=L.g1()*64-this.originZ;if(N>0&&$>0&&N+64<this.sizeX&&$+64<this.sizeZ)for(let G=0;G<64;G++){let m=this.sizeZ-$-1;for(let Q=-64;Q<0;Q++)this.objTiles[G+N][m--]=L.g1()==1}else L.pos+=4096}}readNpcData(L){while(L.available>0){let N=L.g1()*64-this.originX,$=L.g1()*64-this.originZ;if(N>0&&$>0&&N+64<this.sizeX&&$+64<this.sizeZ)for(let G=0;G<64;G++){let m=this.sizeZ-$-1;for(let Q=-64;Q<0;Q++)this.npcTiles[G+N][m--]=L.g1()==1}else L.pos+=4096}}convertHsl(L,N,$){let G=$,m=$,Q=$;if(N!==0){let H;if($<0.5)H=$*(N+1);else H=$+N-$*N;let Z=$*2-H,q=L+0.3333333333333333;if(q>1)q--;let W=L-0.3333333333333333;if(W<0)W++;if(q*6<1)G=Z+(H-Z)*6*q;else if(q*2<1)G=H;else if(q*3<2)G=Z+(H-Z)*(0.6666666666666666-q)*6;else G=Z;if(L*6<1)m=Z+(H-Z)*6*L;else if(L*2<1)m=H;else if(L*3<2)m=Z+(H-Z)*(0.6666666666666666-L)*6;else m=Z;if(W*6<1)Q=Z+(H-Z)*6*W;else if(W*2<1)Q=H;else if(W*3<2)Q=Z+(H-Z)*(0.6666666666666666-W)*6;else Q=Z}let J=G*256|0,T=m*256|0,E=Q*256|0;return(J<<16)+(T<<8)+E}drawMap(L,N,$,G,m,Q,J,T){let E=$-L,H=G-N,Z=(J-m<<16)/E|0,q=(T-Q<<16)/H|0;for(let M=0;M<E;M++){let I=Z*M>>16,U=Z*(M+1)>>16,j=U-I;if(j<=0)continue;I+=m,U+=m;for(let _=0;_<H;_++){let X=q*_>>16,k=q*(_+1)>>16,u=k-X;if(u<=0)continue;if(typeof this.overlayTiles[M+L]==="undefined")continue;X+=Q,k+=Q;let b=this.overlayTiles[M+L][_+N];if(b===0)F.fillRect2d(I,X,U-I,k-X,this.floormapColors[M+L][_+N]);else{let O=this.overlayInfo[M+L][_+N],n=O&252;if(n==0||j<=1||u<=1)F.fillRect2d(I,X,j,u,b);else this.drawSmoothEdges(F.pixels,X*F.width2d+I,this.floormapColors[M+L][_+N],b,j,u,n>>2,O&3)}}}if($-L>J-m)return;let W=0;for(let M=0;M<E;M++){let I=Z*M>>16,U=Z*(M+1)>>16,j=U-I;if(j<=0)continue;if(typeof this.locWalls[M+L]==="undefined")continue;I+=m,U+=m;for(let _=0;_<H;_++){let X=q*_>>16,k=q*(_+1)>>16,u=k-X;if(u<=0)continue;X+=Q,k+=Q;let b=this.locWalls[M+L][_+N]&255;if(b!=0){let V;if(j==1)V=I;else V=U-1;let d;if(u==1)d=X;else d=k-1;let z=13421772;if(b>=5&&b<=8||b>=13&&b<=16||b>=21&&b<=24)z=13369344,b-=4;if(b==27||b==28)z=13369344,b-=2;if(b==1)F.drawVerticalLine(I,X,z,u);else if(b==2)F.drawHorizontalLine(I,X,z,j);else if(b==3)F.drawVerticalLine(V,X,z,u);else if(b==4)F.drawHorizontalLine(I,d,z,j);else if(b==9)F.drawVerticalLine(I,X,16777215,u),F.drawHorizontalLine(I,X,z,j);else if(b==10)F.drawVerticalLine(V,X,16777215,u),F.drawHorizontalLine(I,X,z,j);else if(b==11)F.drawVerticalLine(V,X,16777215,u),F.drawHorizontalLine(I,d,z,j);else if(b==12)F.drawVerticalLine(I,X,16777215,u),F.drawHorizontalLine(I,d,z,j);else if(b==17)F.drawHorizontalLine(I,X,z,1);else if(b==18)F.drawHorizontalLine(V,X,z,1);else if(b==19)F.drawHorizontalLine(V,d,z,1);else if(b==20)F.drawHorizontalLine(I,d,z,1);else if(b==25)for(let P=0;P<u;P++)F.drawHorizontalLine(I+P,d-P,z,1);else if(b==26)for(let P=0;P<u;P++)F.drawHorizontalLine(I+P,X+P,z,1)}let O=this.locMapscenes[M+L][_+N];if(O!=0)this.imageMapscene[O-1].clip(I-j/2,X-u/2,j*2,u*2);let n=this.locMapfunction[M+L][_+N];if(n!=0)this.visibleMapFunctions[W]=n-1,this.visibleMapFunctionsX[W]=I+j/2,this.visibleMapFunctionsY[W]=X+u/2,W++}}for(let M=0;M<W;M++)this.imageMapfunction[this.visibleMapFunctions[M]].draw(this.visibleMapFunctionsX[M]-7,this.visibleMapFunctionsY[M]-7);if(x.shouldDrawItems)for(let M=0;M<E;M++){let I=Z*M>>16,U=Z*(M+1)>>16;if(U-I<=0)continue;if(typeof this.objTiles[M+L]==="undefined")continue;I+=m,U+=m;for(let _=0;_<H;_++){let X=q*_>>16,k=q*(_+1)>>16;if(k-X<=0)continue;if(X+=Q,k+=Q,this.objTiles[M+L][_+N])this.imageMapdot0?.draw(I,X)}}if(x.shouldDrawNpcs)for(let M=0;M<E;M++){let I=Z*M>>16,U=Z*(M+1)>>16;if(U-I<=0)continue;if(typeof this.npcTiles[M+L]==="undefined")continue;I+=m,U+=m;for(let _=0;_<H;_++){let X=q*_>>16,k=q*(_+1)>>16;if(k-X<=0)continue;if(X+=Q,k+=Q,this.npcTiles[M+L][_+N])this.imageMapdot1?.draw(I,X)}}if(this.flashTimer>0){for(let M=0;M<W;M++)if(this.visibleMapFunctions[M]==this.currentKey){if(this.imageMapfunction[this.visibleMapFunctions[M]].draw(this.visibleMapFunctionsX[M]-7,this.visibleMapFunctionsY[M]-7),this.flashTimer%10<5)F.fillCircle(this.visibleMapFunctionsX[M],this.visibleMapFunctionsY[M],15,16776960,128),F.fillCircle(this.visibleMapFunctionsX[M],this.visibleMapFunctionsY[M],7,16777215,256)}}if(this.zoom==this.targetZoom&&x.shouldDrawLabels)for(let M=0;M<this.labelCount;M++){let I=this.labelX[M],U=this.labelY[M];I-=this.originX,U=this.originZ+this.sizeZ-U;let j=m+(J-m)*(I-L)/($-L)|0,_=Q+(T-Q)*(U-N)/(G-N)|0,X=this.labelFont[M],k=16777215,u=this.b12;if(X===2)k=16755200;if(u!==null){let b=this.labelText[M],O=1;for(let n=0;n<b.length;n++)if(b[n]==="/")O++;_-=u.height2d*(O-1)/2;while(!0){let n=b.indexOf("/");if(n===-1){u.drawStringCenter(j+1,_+1,b,0),u.drawStringCenter(j,_,b,k);break}let V=b.substring(0,n);u.drawStringCenter(j+1,_+1,V,0),u.drawStringCenter(j,_,V,k),_+=u.height2d,b=b.substring(n+1)}}}if(x.shouldDrawBorders)for(let M=this.originX/64;M<(this.originX+this.sizeX)/64;M++)for(let I=this.originZ/64;I<(this.originZ+this.sizeZ)/64;I++){let U=M*64,j=I*64;U-=this.originX,j=this.originZ+this.sizeZ-j;let _=m+(J-m)*(U-L)/($-L)|0,X=Q+(T-Q)*(j-64-N)/(G-N)|0,k=m+(J-m)*(U+64-L)/($-L)|0,u=Q+(T-Q)*(j-N)/(G-N)|0;if(_>=J||X>=T||k<=0||u<=0)continue;let b=16777215;if(this.activeTileX!==-1&&this.activeTileZ!==-1)b=16711680;if(F.drawRect(_,X,k-_,u-X,b),this.b12?.drawStringRight(k-5,u-5,M+"_"+I,b,!1),M==33&&I>=71&&I<=73)this.b12?.drawStringCenter((k+_)/2,(u+X)/2,"u_pass",16711680);else if(M>=32&&M<=34&&I>=70&&I<=74)this.b12?.drawStringCenter((k+_)/2,(u+X)/2,"u_pass",16776960)}}drawSmoothEdges(L,N,$,G,m,Q,J,T){let E=F.width2d-m;if(J==9)J=1,T=T+1&3;else if(J==10)J=1,T=T+3&3;else if(J==11)J=8,T=T+3&3;if(J==1){if(T==0)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z<=H)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z<=H)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z>=H)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z>=H)L[N++]=G;else L[N++]=$;N+=E}}else if(J==2){if(T==0)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z<=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z>=H<<1)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=0;H<Q;H++){for(let Z=m-1;Z>=0;Z--)if(Z<=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=Q-1;H>=0;H--){for(let Z=m-1;Z>=0;Z--)if(Z>=H<<1)L[N++]=G;else L[N++]=$;N+=E}}else if(J==3){if(T==0)for(let H=Q-1;H>=0;H--){for(let Z=m-1;Z>=0;Z--)if(Z<=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z>=H<<1)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z<=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=0;H<Q;H++){for(let Z=m-1;Z>=0;Z--)if(Z>=H<<1)L[N++]=G;else L[N++]=$;N+=E}}else if(J==4){if(T==0)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z>=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z<=H<<1)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=0;H<Q;H++){for(let Z=m-1;Z>=0;Z--)if(Z>=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=Q-1;H>=0;H--){for(let Z=m-1;Z>=0;Z--)if(Z<=H<<1)L[N++]=G;else L[N++]=$;N+=E}}else if(J==5){if(T==0)for(let H=Q-1;H>=0;H--){for(let Z=m-1;Z>=0;Z--)if(Z>=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z<=H<<1)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z>=H>>1)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=0;H<Q;H++){for(let Z=m-1;Z>=0;Z--)if(Z<=H<<1)L[N++]=G;else L[N++]=$;N+=E}}else if(J==6){if(T==0)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z<=m/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(H<=Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z>=m/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(H>=Q/2)L[N++]=G;else L[N++]=$;N+=E}}else if(J==7){if(T==0)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z<=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z<=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=Q-1;H>=0;H--){for(let Z=m-1;Z>=0;Z--)if(Z<=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=0;H<Q;H++){for(let Z=m-1;Z>=0;Z--)if(Z<=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}}else if(J==8){if(T==0)for(let H=0;H<Q;H++){for(let Z=0;Z<m;Z++)if(Z>=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==1)for(let H=Q-1;H>=0;H--){for(let Z=0;Z<m;Z++)if(Z>=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==2)for(let H=Q-1;H>=0;H--){for(let Z=m-1;Z>=0;Z--)if(Z>=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}else if(T==3)for(let H=0;H<Q;H++){for(let Z=m-1;Z>=0;Z--)if(Z>=H-Q/2)L[N++]=G;else L[N++]=$;N+=E}}}getTitleScreenState(){return-1}isChatBackInputOpen(){return!1}isShowSocialInput(){return!1}getChatInterfaceId(){return-1}getViewportInterfaceId(){return-1}getReportAbuseInterfaceId(){return-1}}export{x as MapView};

//# debugId=0743C656F99C402B64756E2164756E21
